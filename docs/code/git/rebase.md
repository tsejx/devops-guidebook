---
nav:
  title: ä»£ç ç®¡ç†
  order: 5
title: å˜åŸº git rebase
order: 23
---

# å˜åŸº git rebase

> Reapply commits on top of another base tip
>
> å¦ä¸€ä¸ªåŸºæœ¬æç¤ºä¸Šé‡æ–°åº”ç”¨æäº¤

å¦‚æœéœ€è¦è·å¾—æ›´æ¸…æ™°çš„ä¿®è®¢å†å²è®°å½•ï¼Œå¯ä»¥ä½¿ç”¨ `git rebase` å‘½ä»¤é›†æˆåˆ†æ”¯ã€‚

## å˜åŸºè‡³ä¸»åˆ†æ”¯

å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼Œå…¶ä¸­åŒ…å« `non-fast-forward` æ–¹æ¡ˆã€‚

![Rebase01](../../assets/git/rebase_branch_001.png)

```bash
# å˜åŸº rebase ä¸åˆå¹¶ merge ä¸åŒï¼Œæ˜¯åŸºäºè¢« rebase çš„ commit ä¸Šæ“ä½œçš„
# åˆ‡æ¢è‡³æ¬¡åˆ†æ”¯
git checkout bugfix

# å˜åŸºè‡³ä¸»åˆ†æ”¯
git rebase master

# åˆ‡æ¢åˆ°ä¸»åˆ†æ”¯
git checkout master

# å†åˆå¹¶å·²ç»å˜åŸºçš„ bugfix
git merge bugfix
```

æ•´ä¸ª `bugfix` åˆ†æ”¯ä¸Šçš„æäº¤ä¼šç§»åŠ¨åˆ° master åˆ†æ”¯çš„åé¢ï¼Œæœ‰æ•ˆåœ°æŠŠæ‰€æœ‰ master åˆ†æ”¯ä¸Šæ–°çš„æäº¤å¹¶å…¥è¿‡æ¥ã€‚

æ‰§è¡Œ `rebase` å‘½ä»¤å°†å¯¼è‡´åˆ†æ”¯å†å²è®°å½•çœ‹èµ·æ¥ç±»ä¼¼äºä¸‹é¢çš„å›¾ç¤ºã€‚

![Rebase01](../../assets/git/rebase_branch_002.png)

å½“æ‚¨å°†é”™è¯¯ä¿®å¤åˆ†æ”¯é‡æ–°ç»‘å®šåˆ°ä¸»åˆ†æ”¯æ—¶ï¼Œå°†ä¿®å¤æ¥è‡ªé”™è¯¯ä¿®å¤åˆ†æ”¯çš„æäº¤å¹¶å°†å…¶é™„åŠ åˆ°ä¸»åˆ†æ”¯çš„æœ«å°¾ã€‚æœ€ç»ˆç»“æœæ˜¯ `bugfix` åˆ†æ”¯å†å²è®°å½•ä¸€ä¸ªç®€å• commit æµã€‚

å¦‚æœåœ¨é™„åŠ æäº¤æ—¶å‘ç”Ÿä»£ç å†²çªï¼ŒGit ä¼šè¦æ±‚æ‚¨åœ¨ç»§ç»­é‡æ–°è®¾ç½®å…¶ä»–æäº¤ä¹‹å‰ä¿®å¤å†²çªã€‚

![Rebase01](../../assets/git/rebase_branch_003.png)

![Rebase01](../../assets/git/rebase_branch_004.png)

`rebase` ä¸ä¼šç§»åŠ¨ `master` åˆ†æ”¯çš„ä½ç½®ã€‚åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œæ‚¨éƒ½å¯ä»¥åœ¨ `rebase` åæ‰§è¡Œä» `bugfix` åˆ° `master` çš„ `fast-forward` æˆ–æ¸…é™¤åˆå¹¶ã€‚

å¯¹äº `merge` å’Œ `rebase` çš„åŒºåˆ«ï¼Œå®è´¨ä¸Š:

- `merge` æ˜¯å¯¹ç›®å‰åˆ†å‰çš„ä¸¤æ¡åˆ†æ”¯çš„åˆå¹¶
- `rebase` æ˜¯å¯¹å½“å‰åˆ†æ”¯è®°å½•åŸºäºä»»ä½• `commit` èŠ‚ç‚¹ï¼ˆä¸é™äºå½“å‰åˆ†æ”¯ä¸Šçš„èŠ‚ç‚¹ï¼‰çš„å˜æ›´

`rebase` çš„ `base` ä¸èƒ½ç†è§£ä¸ºåˆ†å‰çš„åŸºç‚¹ï¼Œè€Œæ˜¯æ•´ä¸ª `git` åº“ä¸­å­˜åœ¨çš„æ‰€æœ‰ `commit` èŠ‚ç‚¹:

- åœ¨ `git pull â€”-rebase` çš„æ—¶å€™ï¼Œè¿™ä¸ªå½“å‰åˆ†æ”¯æ˜¯æœ¬åœ°åˆ†æ”¯ï¼Œ`commit` èŠ‚ç‚¹æ˜¯è¿œç¨‹åˆ†æ”¯çš„ `head`
- åœ¨ `git rebase master` çš„æ—¶å€™ï¼Œè¿™ä¸ªå½“å‰åˆ†æ”¯æ˜¯ `feature` åˆ†æ”¯ï¼Œ`commit` èŠ‚ç‚¹æ˜¯ `master` åˆ†æ”¯çš„ `head`
- åœ¨ `git rebase -i` çš„æ—¶å€™ï¼Œè¿™ä¸ªå½“å‰åˆ†æ”¯å°±æ˜¯å½“å‰å·¥ä½œåˆ†æ”¯ï¼Œ`commit` èŠ‚ç‚¹æ˜¯åœ¨ `-i` åæ³¨æ˜çš„ `commit`

## äº¤äº’å¼å˜åŸº

äº¤äº’å¼å˜åŸºå…è®¸ä½ æ›´æ”¹å¹¶å…¥æ–°åˆ†æ”¯çš„æäº¤ã€‚è¿™æ¯”è‡ªåŠ¨çš„å˜åŸºæ›´åŠ å¼ºå¤§ï¼Œå› ä¸ºå®ƒæä¾›äº†å¯¹åˆ†æ”¯ä¸Šæäº¤å†å²å®Œæ•´çš„æ§åˆ¶ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™è¢«ç”¨äºå°† `feature` åˆ†æ”¯å¹¶å…¥ `master` åˆ†æ”¯ä¹‹å‰ï¼Œæ¸…ç†æ··ä¹±çš„å†å²ã€‚

```bash
# è¯­æ³•
git rebase -i [startpoint] [endpoint]

# ç¤ºä¾‹
git checkout feature
git rebase -i master
```

å®ƒä¼šæ‰“å¼€ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ˜¾ç¤ºæ‰€æœ‰å°†è¢«ç§»åŠ¨çš„æäº¤ï¼š

```bash
pick 33d5b7a Message for commit #1
pick 9480b3d Message for commit #2
pick 5c67e61 Message for commit #3
```

ç„¶å `wq` ä¿å­˜é€€å‡ºåæ˜¯æ³¨é‡Šä¿®æ”¹ï¼Œç¼–è¾‘å®Œæ³¨é‡Šå† `wq` ä¿å­˜å®Œæˆ commit åˆå¹¶ã€‚

- pickï¼šä¿ç•™è¯¥ commit
- rewordï¼šä¿ç•™è¯¥ commitï¼Œä½†æˆ‘éœ€è¦ä¿®æ”¹è¯¥ commit çš„æ³¨é‡Š
- editï¼šä¿ç•™è¯¥ commitï¼Œä½†æˆ‘è¦åœä¸‹æ¥ä¿®æ”¹è¯¥æäº¤ï¼ˆä¸ç¦æƒŠä¿®æ”¹æ³¨é‡Šï¼‰
- squashï¼šå°†è¯¥ commit å’Œå‰ä¸€ä¸ª commit åˆå¹¶
- fixupï¼šå°†è¯¥ commit å’Œå‰ä¸€ä¸ª commit åˆå¹¶ï¼Œä½†æˆ‘ä¸è¦ä¿ç•™è¯¥æäº¤çš„æ³¨é‡Šä¿¡æ¯
- execï¼šæ‰§è¡Œ shell å‘½ä»¤
- dropï¼šæˆ‘è¦ä¸¢å¼ƒè¯¥ commit

å¿½ç•¥ä¸é‡è¦çš„æäº¤ä¼šè®©ä½ çš„ feature åˆ†æ”¯çš„å†å²æ›´æ¸…æ™°æ˜“è¯»ï¼Œè¿™æ˜¯ `git merge` åšä¸åˆ°çš„ã€‚

## åˆ†æ”¯åˆå¹¶

è¢«åˆå¹¶åˆ†æ”¯åªæœ‰ä½ è‡ªå·±ä½¿ç”¨ã€‚

1. å…ˆä» master åˆ†æ”¯åˆ‡å‡ºä¸€ä¸ª `feature` åˆ†æ”¯ï¼Œè¿›è¡Œå¼€å‘ï¼š`git:(master) git checkout -b feature`
2. è¿™æ—¶åŒäº‹å®Œæˆä¸€æ¬¡ `hotfix`ï¼Œä¸”åˆå¹¶å…¥ master åˆ†æ”¯ï¼Œæ­¤æ—¶ master å·²ç»é¢†å…ˆäºä½ çš„ `feature` åˆ†æ”¯
3. ä½¿ç”¨ `git rebase master` è¿›è¡Œåˆ†æ”¯åˆå¹¶

`rebase` åŸç†ï¼š

1. é¦–å…ˆï¼Œgit ä¼šæŠŠ `feature` åˆ†æ”¯é‡Œé¢çš„æ¯ä¸ª `commit` å–æ¶ˆæ‰
2. å…¶æ¬¡ï¼ŒæŠŠä¸Šé¢çš„æ“ä½œä¸´æ—¶ä¿å­˜æˆ `patch` æ–‡ä»¶ï¼Œå­˜åœ¨ `.git/reabase` ç›®å½•ä¸‹
3. ç„¶åï¼ŒæŠŠ `feature` åˆ†æ”¯æ›´æ–°åˆ°æœ€æ–°çš„ `master` åˆ†æ”¯
4. æœ€åï¼ŒæŠŠä¸Šé¢ä¿å­˜çš„ `patch` æ–‡ä»¶åº”ç”¨åˆ° `feature` åˆ†æ”¯ä¸Š

åœ¨ `rebase` è¿‡ç¨‹ä¸­ï¼Œå‡ºç°å†²çª conflict åï¼Œgit ä¼šåœæ­¢ rebase å¹¶ä¼šè®©ä½ è§£å†³å†²çªã€‚è§£å†³å®Œå†²çªåï¼Œç”¨ `git add` å‘½ä»¤å»æ›´æ–°è¿™äº›å†…å®¹ï¼Œå³æ‰§è¡Œ `git rebase --continue`ã€‚

âš ï¸ æ³¨æ„ï¼šä½ æ— éœ€æ‰§è¡Œ `git commit`ï¼Œåªè¦æ‰§è¡Œ `git rebase --continue`ã€‚

åœ¨ä»»ä½•æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ç”¨ `git rebase -abort` æ¥ç»ˆæ­¢ `rebase` çš„è¡ŒåŠ¨ï¼Œå¹¶ä¸”åˆ†æ”¯ä¼šå›åˆ° `rebase` å¼€å§‹å‰çš„çŠ¶æ€ã€‚

## é»„é‡‘æ³•åˆ™

> æ°¸è¿œä¸è¦å¯¹å·²ç»æ¨åˆ°ä¸»å¹²åˆ†æ”¯æœåŠ¡å™¨æˆ–è€…å›¢é˜Ÿå…¶ä»–æˆå‘˜çš„æäº¤è¿›è¡Œå˜åŸºï¼Œæˆ‘ä»¬é€‰æ‹©å˜åŸºè¿˜æ˜¯åˆå¹¶çš„èŒƒå›´åº”è¯¥åœ¨è‡ªå·±å½“å‰å·¥ä½œèŒƒå›´å†…ã€‚

---

**å‚è€ƒèµ„æ–™ï¼š**

- [ğŸ“ Git ç”±æµ…å…¥æ·±ä¹‹ç»†è¯´å˜åŸº](https://juejin.im/post/58f97793a22b9d00658b15b6)
- [ğŸ“ å…³äº Git Rebase ä½ å¿…é¡»è¦çŸ¥é“çš„å‡ ä»¶äº‹](https://juejin.im/post/5ed47d006fb9a047da363b62)
- [ğŸ“ ä»æ’¤é”€ Rebase è°ˆè°ˆ Git åŸç†](https://juejin.im/post/5a65ac67f265da3e330473f7)
- [ğŸ“ ä½¿ç”¨ git rebase æé«˜ PR è´¨é‡](https://juejin.im/post/6844903497645686797)
- [ğŸ“ Merge å’Œ Rebase åŒºåˆ«ä¸é¡¹ç›®ä¸­çš„é€‰æ‹©](https://juejin.im/post/5e3d78d1f265da575632453e)
- [ğŸ“ Git Merge å’Œ Rebase åˆ†æ”¯åˆå¹¶å‘½ä»¤çš„åŒºåˆ«](https://juejin.im/post/5af26c4d5188256728605809)
- [ğŸ“ ä½ æ ¹æœ¬ä¸æ‡‚ rebase ä½¿ç”¨ rebase æ‰“é€ å¯è¯»çš„ git graph](https://juejin.im/post/5cb20c45e51d456e2e656d11)
- [ğŸ“ Git åº”ç”¨è¯¦è§£ç¬¬ä¹è®²ï¼šgit cherry-pick ä¸ git rebase](https://juejin.im/post/5e9d21f26fb9a03c4e648412)
- [ğŸ“ ä½¿ç”¨ Git Rebase ç¾åŒ– GIt COmmit æµç¨‹](https://juejin.im/entry/59e5d7b051882521ae145b91/detail)
