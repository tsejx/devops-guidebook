---
nav:
  title: æœåŠ¡å™¨
  order: 2
group:
  title: Nginx
  order: 1
title: åŸºæœ¬æ¦‚è¦
order: 1
---

# åŸºæœ¬æ¦‚è¦

Nginx æ˜¯ä¸€ä¸ªå¼€æºä¸”é«˜æ€§èƒ½ã€å¯é çš„ HTTP ä¸­é—´ä»¶ï¼Œä»£ç†æœåŠ¡ã€‚Nginxï¼ˆå‘éŸ³åŒ engine xï¼‰æ˜¯ä¸€ä¸ª Web æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥ç”¨ä½œåå‘ä»£ç†ï¼Œè´Ÿè½½å¹³è¡¡å™¨å’Œ HTTP ç¼“å­˜ã€‚è¯¥è½¯ä»¶ç”± Igor Sysoev åˆ›å»ºï¼Œå¹¶äº 2004 å¹´é¦–æ¬¡å…¬å¼€å‘å¸ƒã€‚åŒåå…¬å¸æˆç«‹äº 2011 å¹´ï¼Œä»¥æä¾›æ”¯æŒã€‚

## å·¥ä½œåŸç†

é¦–å…ˆè¦æ˜ç™½ï¼ŒNginx é‡‡ç”¨çš„æ˜¯å¤šè¿›ç¨‹ï¼ˆå•çº¿ç¨‹ï¼‰ + å¤šè·¯ IO å¤ç”¨æ¨¡å‹ã€‚ä½¿ç”¨äº† I/O å¤šè·¯å¤ç”¨æŠ€æœ¯çš„ Nginxï¼Œå°±æˆäº† **å¹¶å‘äº‹ä»¶é©±åŠ¨** çš„æœåŠ¡å™¨ã€‚

### å¤šè¿›ç¨‹çš„å·¥ä½œæ¨¡å¼

- Nginx åœ¨å¯åŠ¨åï¼Œä¼šä»¥ daemon çš„æ–¹å¼åœ¨åå°è¿è¡Œï¼Œåå°è¿›ç¨‹åŒ…å«ä¸€ä¸ª `master` è¿›ç¨‹å’Œå¤šä¸ªç›¸äº’ç‹¬ç«‹çš„ `worker` è¿›ç¨‹ã€‚å·¥ä½œè¿›ç¨‹ä»¥éç‰¹æƒç”¨æˆ·è¿è¡Œã€‚
- `master` è¿›ç¨‹ä¸»è¦ç”¨æ¥ç®¡ç† `worker` è¿›ç¨‹ï¼ŒåŒ…å«ï¼šæ¥æ”¶æ¥è‡ªå¤–ç•Œçš„ä¿¡å·ï¼Œå‘å„ `worker` è¿›ç¨‹å‘é€ä¿¡å·ï¼Œç›‘æ§ `worker` è¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ï¼Œå½“ `worker` è¿›ç¨‹é€€å‡ºåï¼ˆå¼‚å¸¸æƒ…å†µä¸‹ï¼‰ï¼Œä¼šè‡ªåŠ¨é‡æ–°å¯åŠ¨æ–°çš„ `worker` è¿›ç¨‹ã€‚
- `worker` è¿›ç¨‹åˆ™æ˜¯å¤„ç†åŸºæœ¬çš„ç½‘ç»œäº‹ä»¶ã€‚å¤šä¸ª `worker` è¿›ç¨‹ä¹‹é—´æ˜¯å¯¹ç­‰çš„ï¼Œä»–ä»¬åŒç­‰ç«äº‰æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå„è¿›ç¨‹äº’ç›¸ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ã€‚ä¸€ä¸ªè¯·æ±‚ï¼Œåªå¯èƒ½åœ¨ä¸€ä¸ª `worker` è¿›ç¨‹ä¸­å¤„ç†ï¼Œä¸€ä¸ª `worker` è¿›ç¨‹ï¼Œä¸å¯èƒ½å¤„ç†å…¶å®ƒè¿›ç¨‹çš„è¯·æ±‚ã€‚

å·¥ä½œçº¿ç¨‹å¤„ç†å®é™…çš„è¯·æ±‚ã€‚Nginx ä½¿ç”¨**åŸºäºäº‹ä»¶**çš„æ¨¡å‹å’Œ**ä¾èµ–æ“ä½œç³»ç»Ÿ**çš„æœºåˆ¶æ¥æœ‰æ•ˆåœ°åœ¨å·¥ä½œè¿›ç¨‹ä¹‹é—´åˆ†å‘è¯·æ±‚ã€‚

> worker è¿›ç¨‹æ•°ï¼Œä¸€èˆ¬ä¼šè®¾ç½®æˆæœºå™¨ CPU æ ¸æ•°ã€‚å› ä¸ºæ›´å¤šçš„ worker æ•°ï¼Œåªä¼šå¯¼è‡´è¿›ç¨‹ç›¸äº’ç«äº‰ CPUï¼Œä»è€Œå¸¦æ¥ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚
> ä½¿ç”¨å¤šè¿›ç¨‹æ¨¡å¼ï¼Œä¸ä»…èƒ½æé«˜å¹¶æ³•ç‡ï¼Œè€Œä¸”è¿›ç¨‹ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œä¸€ä¸ª worker è¿›ç¨‹æŒ‚äº†ä¸ä¼šå½±å“å…¶ä»– worker è¿›ç¨‹ã€‚

### æƒŠç¾¤ç°è±¡

- ä¸»è¿›ç¨‹ï¼ˆmaster è¿›ç¨‹ï¼‰é¦–å…ˆé€šè¿‡ `socket()` æ¥åˆ›å»ºä¸€ä¸ª sock æ–‡ä»¶æè¿°ç¬¦ç”¨æ¥ç›‘å¬ï¼Œç„¶å `fork` ç”Ÿæˆå­è¿›ç¨‹ï¼ˆworkers è¿›ç¨‹ï¼‰ï¼Œå­è¿›ç¨‹å°†ç»§æ‰¿çˆ¶è¿›ç¨‹çš„ `sockfd`ï¼ˆsocket æ–‡ä»¶æè¿°ç¬¦ï¼‰ï¼Œä¹‹åå­è¿›ç¨‹ `accept()` åå°†åˆ›å»ºå·²è¿æ¥æè¿°ç¬¦ï¼ˆconnected descriptorï¼‰ï¼‰ï¼Œç„¶åé€šè¿‡å·²è¿æ¥æè¿°ç¬¦æ¥ä¸å®¢æˆ·ç«¯é€šä¿¡ã€‚
- é‚£ä¹ˆï¼Œç”±äºæ‰€æœ‰å­è¿›ç¨‹éƒ½ç»§æ‰¿äº†çˆ¶è¿›ç¨‹çš„ `sockfd`ï¼Œé‚£ä¹ˆå½“è¿æ¥è¿›æ¥æ—¶ï¼Œæ‰€æœ‰å­è¿›ç¨‹éƒ½å°†æ”¶åˆ°é€šçŸ¥å¹¶ **äº‰ç€** ä¸å®ƒå»ºç«‹è¿æ¥ï¼Œè¿™å°±å« **æƒŠç¾¤ç°è±¡**ã€‚å¤§é‡çš„è¿›ç¨‹è¢«æ¿€æ´»åˆæŒ‚èµ·ï¼Œåªæœ‰ä¸€ä¸ªè¿›ç¨‹å¯ä»¥ `accept()` åˆ°è¿™ä¸ªè¿æ¥ï¼Œè¿™å½“ç„¶ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºã€‚

## ä¸­é—´ä»¶æ¶æ„

å¤šä¸ªæè¿°ç¬¦çš„ I/O æ“ä½œéƒ½èƒ½åœ¨ä¸€ä¸ªçº¿ç¨‹å†…å¹¶å‘äº¤æ›¿åœ°é¡ºåºå®Œæˆï¼Œè¿™å°±æ•™ I/O å¤šè·¯å¤ç”¨ï¼Œè¿™é‡Œçš„ **å¤ç”¨** æŒ‡çš„æ˜¯å¤ç”¨åŒä¸€ä¸ªçº¿ç¨‹ã€‚I/O å¤šè·¯å¤ç”¨çš„å®ç°æ–¹å¼ä¸ºï¼š`select`ã€`poll`ã€`epoll`ã€‚

Nginx é‡‡ç”¨çš„ I/O å¤šè·¯å¤ç”¨æ¨¡å‹ `epoll`ã€‚

### CPU äº²å’Œ

CPU äº²å’Œæ˜¯ä¸€ç§ CPU æ ¸å¿ƒå’Œ Nginx å·¥ä½œè¿›ç¨‹ç»‘å®šæ–¹å¼ï¼ŒæŠŠæ¯ä¸ª worker è¿›ç¨‹å›ºå®šåœ¨ä¸€ä¸ª CPU ä¸Šæ‰§è¡Œï¼Œå‡å°‘åˆ‡æ¢ CPU çš„ `cache miss`ï¼Œè·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚

è¯´ç™½äº†å°±æ˜¯å‡å°‘ CPU åˆ‡æ¢æ‰€æŸè€—çš„æ€§èƒ½ã€‚

## å®‰è£…ç›®å½•

åˆ—å‡º Nginx æœåŠ¡çš„å®‰è£…ç›®å½•ï¼š

```bash
rpm -ql nginx
```

| è·¯å¾„                                                                                                                                                  | ç±»å‹           | ä½œç”¨                                           |
| :---------------------------------------------------------------------------------------------------------------------------------------------------- | :------------- | :--------------------------------------------- |
| `/etc/logrotate.d/nginx`                                                                                                                              | é…ç½®æ–‡ä»¶       | nginx æ—¥å¿—è½®è½¬ï¼Œç”¨äº logrotate æœåŠ¡çš„æ—¥å¿—åˆ‡å‰²  |
| `/etc/nginx/`<br/>`/etc/nginx/conf.d`<br/>`/etc/nginx/conf.d/default.conf`<br/>`/etc/nginx/nginx.conf`                                                | ç›®å½•ã€é…ç½®æ–‡ä»¶ | nginx ä¸»é…ç½®æ–‡ä»¶                               |
| `/etc/nginx/fastcgi_params`<br/>`/etc/nginx/scgi_params`<br/>`/etc/nginx/uwsgi_params`                                                                | é…ç½®æ–‡ä»¶       | cgi é…ç½®ç›¸å…³ï¼Œfastcgi é…ç½®                     |
| `/etc/nginx/koi-utf`<br/>`/etc/nginx/koi-win`<br/>`/etc/nginx/win-utf`                                                                                | é…ç½®æ–‡ä»¶       | ç¼–ç æ˜ å°„è½¬åŒ–æ–‡ä»¶                               |
| `/etc/nginx/mime.types`                                                                                                                               | é…ç½®æ–‡ä»¶       | è®¾ç½® HTTP åè®®çš„ Content-Type ä¸æ‰©å±•åå¯¹åº”å…³ç³» |
| `/etc/sysconfig/nginx`<br/>`/etc/sysconfig/nginx-debug`<br/>`/usr/lib/systemd/system/nginx-debug.service`<br/>`/usr/lib/systemd/system/nginx.service` | é…ç½®æ–‡ä»¶       | ç”¨äºé…ç½®å‡ºç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹ç®¡ç†å™¨ç®¡ç†æ–¹å¼           |
| `/etc/nginx/modules`<br/>`/usr/lib64/nginx/modules`                                                                                                   | ç›®å½•           | nginx æ¨¡å—ç›®å½•                                 |
| `/usr/sbin/nginx`<br/>`/usr/sbin/nginx-debug`                                                                                                         | å‘½ä»¤           | nginx æœåŠ¡çš„å¯æ‰§è¡Œç¨‹åºæ–‡ä»¶ï¼ˆç»ˆç«¯å‘½ä»¤ï¼‰         |
| `/usr/share/doc/nginx-1.12.2`<br/>`/usr/share/doc/nginx-1.12.2/COPYRIGHT`<br/>`/usr/share/man/man8/nginx.8.gz`                                        | æ–‡ä»¶ç›®å½•       | nginx çš„æ‰‹å†Œå’Œå¸®åŠ©æ–‡ä»¶                         |
| `/var/cache/nginx`                                                                                                                                    | ç›®å½•           | nginx çš„ç¼“å­˜ç›®å½•                               |
| `/var/log/nginx`                                                                                                                                      | ç›®å½•           | nginx çš„æ—¥å¿—ç›®å½•                               |
| `/usr/share/nginx/html/404.html`<br/>`/usr/share/nginx/html/50x.html`<br/>`/usr/share/nginx/html/index.html`                                          | æ–‡ä»¶           | nginx é»˜è®¤çš„é™æ€èµ„æºç›®å½•                       |

Nginx åŠå…¶æ¨¡å—çš„å·¥ä½œæ–¹å¼ç”±é…ç½®æ–‡ä»¶ç¡®å®šã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œé…ç½®æ–‡ä»¶åä¸º `nginx.conf`ï¼Œæ”¾åœ¨ `/etc/nginx/conf.d`ã€`/usr/local/nginx/conf` æˆ–è€… `/usr/local/etc/nginx` æ–‡ä»¶å¤¹ä¸­ã€‚

## ç¼–è¯‘å‚æ•°

åˆ—å‡ºç¼–è¯‘å‚æ•°çš„å‘½ä»¤ï¼š

```bash
nginx -V
```

| è·¯å¾„                                                                                                                                                                                                                                                                                                                         | ç±»å‹                                     |
| :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :--------------------------------------- |
| `--prefix=/etc/nginx`<br/>`--sbin-path=/usr/sbin/nginx`<br/>`--modules-path=/usr/lib64/nginx/modules`<br/>`--conf-path=/etc/nginx/nginx.conf`<br/>`--error-log-path=/var/log/nginx/error.log`<br/>`--http-log-path=/var/log/nginx/access.log`<br/>`--pid-path=/var/run/nginx.pid`<br/>`--lock-path=/var/run/nginx.lock`<br/> | å®‰è£…ç›®å½•                                 |
| `--http-client-body-temp-path=/var/cache/nginx/client_temp`<br/>`--http-proxy-temp-path=/var/cache/nginx/proxy_temp`<br/>`--http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp`<br/>`--http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp`<br/>`--http-scgi-temp-path=/var/cache/nginx/scgi_temp`                            | æ‰§è¡Œå¯¹åº”æ¨¡å—æ—¶ï¼ŒNginx æ‰€ä¿ç•™çš„ä¸´æ—¶æ€§æ–‡ä»¶ |
| `--user=nginx --group=nginx`                                                                                                                                                                                                                                                                                                 | è®¾å®š Nginx è¿›ç¨‹å¯åŠ¨çš„ç”¨æˆ·å’Œç»„ç”¨æˆ·        | cgi é…ç½®ç›¸å…³ï¼Œfastcgi é…ç½® |
| `--with-cc-opt=parameters`                                                                                                                                                                                                                                                                                                   | è®¾ç½®é¢å¤–çš„å‚æ•°å°†æ·»åŠ åˆ° CFLAGS å˜é‡       | ç¼–ç æ˜ å°„è½¬åŒ–æ–‡ä»¶ |
| `--with-ld-opt=parameters`                                                                                                                                                                                                                                                                                                   | è®¾ç½®é™„åŠ çš„å‚æ•°ï¼Œè¿æ¥ç³»ç»Ÿåº“               | è®¾ç½® HTTP åè®®çš„ Content-Type ä¸æ‰©å±•åå¯¹åº”å…³ç³» |

---

**å‚è€ƒèµ„æ–™ï¼š**

- [ğŸ“ Nginx å·¥ä½œåŸç†ï¼ˆMaster+Workerï¼‰](https://www.cnblogs.com/yblackd/p/12194143.html)
- [ğŸ“ Nginx æœ€å…¨æ“ä½œæ€»ç»“](https://mp.weixin.qq.com/s/ZaKUtj7NgRSI72m5S4quDg)
