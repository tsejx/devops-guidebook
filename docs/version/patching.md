---
nav:
  title: ç‰ˆæœ¬ç®¡ç†
  order: 5
title: ä¿®è¡¥
order: 8
---

# ä¿®è¡¥

## å˜åŸº git rebase

> Reapply commits on top of another base tip
>
> å¦ä¸€ä¸ªåŸºæœ¬æç¤ºä¸Šé‡æ–°åº”ç”¨æäº¤

å¦‚æœéœ€è¦è·å¾—æ›´æ¸…æ™°çš„ä¿®è®¢å†å²è®°å½•ï¼Œå¯ä»¥ä½¿ç”¨ `git rebase` å‘½ä»¤é›†æˆåˆ†æ”¯ã€‚

å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼Œå…¶ä¸­åŒ…å« non-fast-forward æ–¹æ¡ˆã€‚

![Rebase01](../assets/git/rebase_branch_001.png)

æ‰§è¡Œ rebase å‘½ä»¤å°†å¯¼è‡´åˆ†æ”¯å†å²è®°å½•çœ‹èµ·æ¥ç±»ä¼¼äºä¸‹é¢çš„å›¾ç¤ºã€‚

![Rebase01](../assets/git/rebase_branch_002.png)

å½“æ‚¨å°†é”™è¯¯ä¿®å¤åˆ†æ”¯é‡æ–°ç»‘å®šåˆ°ä¸»åˆ†æ”¯æ—¶ï¼Œå°†ä¿®å¤æ¥è‡ªé”™è¯¯ä¿®å¤åˆ†æ”¯çš„æäº¤å¹¶å°†å…¶é™„åŠ åˆ°ä¸»åˆ†æ”¯çš„æœ«å°¾ã€‚æœ€ç»ˆç»“æœæ˜¯ bugfix åˆ†æ”¯å†å²è®°å½•ä¸€ä¸ªç®€å•æäº¤æµã€‚

å¦‚æœåœ¨é™„åŠ æäº¤æ—¶å‘ç”Ÿä»£ç å†²çªï¼ŒGit ä¼šè¦æ±‚æ‚¨åœ¨ç»§ç»­é‡æ–°è®¾ç½®å…¶ä»–æäº¤ä¹‹å‰ä¿®å¤å†²çªã€‚

![Rebase01](../assets/git/rebase_branch_003.png)

![Rebase01](../assets/git/rebase_branch_004.png)

Rebase ä¸ä¼šç§»åŠ¨ master åˆ†æ”¯çš„ä½ç½®ã€‚åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œæ‚¨éƒ½å¯ä»¥åœ¨ rebase åæ‰§è¡Œä» bugfix åˆ° master çš„ fast-forward æˆ–æ¸…é™¤åˆå¹¶ã€‚

### å˜åŸºè‡³ä¸»åˆ†æ”¯

ğŸ“**ç¤ºä¾‹ï¼š**

```bash
# åˆ‡æ¢è‡³æ¬¡åˆ†æ”¯
$ git checkout feature

# å˜åŸºè‡³ä¸»åˆ†æ”¯
$ git rebase master
```

æ•´ä¸ª feature åˆ†æ”¯ä¸Šçš„æäº¤ä¼šç§»åŠ¨åˆ° master åˆ†æ”¯çš„åé¢ï¼Œæœ‰æ•ˆåœ°æŠŠæ‰€æœ‰ master åˆ†æ”¯ä¸Šæ–°çš„æäº¤å¹¶å…¥è¿‡æ¥ã€‚

ä½†æ˜¯ï¼Œrebase ä¸ºåŸåˆ†æ”¯ä¸Šæ¯ä¸€ä¸ªæäº¤åˆ›å»ºä¸€ä¸ªæ–°çš„æäº¤ï¼Œé‡å†™äº†é¡¹ç›®å†å²ï¼Œå¹¶ä¸”ä¸ä¼šå¸¦æ¥åˆå¹¶æäº¤ã€‚

### äº¤äº’å¼å˜åŸº

äº¤äº’å¼å˜åŸºå…è®¸ä½ æ›´æ”¹å¹¶å…¥æ–°åˆ†æ”¯çš„æäº¤ã€‚è¿™æ¯”è‡ªåŠ¨çš„å˜åŸºæ›´åŠ å¼ºå¤§ï¼Œå› ä¸ºå®ƒæä¾›äº†å¯¹åˆ†æ”¯ä¸Šæäº¤å†å²å®Œæ•´çš„æ§åˆ¶ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™è¢«ç”¨äºå°† feature åˆ†æ”¯å¹¶å…¥ master åˆ†æ”¯ä¹‹å‰ï¼Œæ¸…ç†æ··ä¹±çš„å†å²ã€‚

ğŸ“– **è¯­æ³•**

```bash
$ git rebase -i [startpoint] [endpoint]
```

 ğŸ“ **ç¤ºä¾‹ï¼š**

```bash
$ git checkout feature
$ git rebase -i master
```

å®ƒä¼šæ‰“å¼€ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ˜¾ç¤ºæ‰€æœ‰å°†è¢«ç§»åŠ¨çš„æäº¤ï¼š

```bash
pick 33d5b7a Message for commit #1
pick 9480b3d Message for commit #2
pick 5c67e61 Message for commit #3
```

* pickï¼šæ­£å¸¸é€‰æ‹©
* rewordï¼šé€‰ä¸­ï¼Œå¹¶ä¸”ä¿®æ”¹æäº¤ä¿¡æ¯
* editï¼šé€‰ä¸­ï¼Œrebase æ—¶ä¼šæš‚åœï¼Œå…è®¸ä½ ä¿®æ”¹è¿™ä¸ª commit
* squashï¼šé€‰ä¸­ï¼Œä¼šå°†å½“å‰ commit ä¸ä¸Šä¸€ä¸ª commit åˆå¹¶
* fixupï¼šä¸ squash ç›¸åŒï¼Œä½†ä¸ä¼šä¿å­˜å½“å‰ commit çš„æäº¤ä¿¡æ¯
* execï¼šæ‰§è¡Œå…¶ä»– shell å‘½ä»¤

å¿½ç•¥ä¸é‡è¦çš„æäº¤ä¼šè®©ä½ çš„ feature åˆ†æ”¯çš„å†å²æ›´æ¸…æ™°æ˜“è¯»ï¼Œè¿™æ˜¯ `git merge` åšä¸åˆ°çš„ã€‚

### é»„é‡‘æ³•åˆ™

> æ°¸è¿œä¸è¦å¯¹å·²ç»æ¨åˆ°ä¸»å¹²åˆ†æ”¯æœåŠ¡å™¨æˆ–è€…å›¢é˜Ÿå…¶ä»–æˆå‘˜çš„æäº¤è¿›è¡Œå˜åŸºï¼Œæˆ‘ä»¬é€‰æ‹©å˜åŸºè¿˜æ˜¯åˆå¹¶çš„èŒƒå›´åº”è¯¥åœ¨è‡ªå·±å½“å‰å·¥ä½œèŒƒå›´å†…ã€‚

## è¿˜åŸ git revert

> Revert some existing commits
>
> æ¢å¤ä¸€äº›ç°æœ‰çš„æäº¤

å¼€å‘è€…å¯ä»¥ä½¿ç”¨ `git revert` å‘½ä»¤æ’¤é”€å·²ç» push åˆ°è¿œç¨‹ä»“åº“çš„ commit æäº¤ã€‚

å½“ä½ æƒ³ä½¿ç”¨ `git reset` æˆ– `git rebase -i` ä»å†å²è®°å½•ä¸­åˆ é™¤ä¸Šä¸€æ¬¡ commit æäº¤ï¼Œè¿™ä¹Ÿè®¸ä¸æ˜¯ä¸€ç§å¾ˆå¥½çš„æ“ä½œæ–¹å¼ï¼Œä¸»è¦æ˜¯å› ä¸ºè¿™ä¼šå¯¼è‡´è¿œç¨‹ä»“åº“ä¸å…¶ä»–åä½œæˆå‘˜çš„æœ¬åœ°ä»“åº“ä¸åŒæ­¥ã€‚

![Revert](../assets/git/undoing_changes_001.png)

### è¿˜åŸæäº¤

`git revert` ä¼šæäº¤ä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ï¼Œå°†éœ€è¦ revert çš„ç‰ˆæœ¬çš„å†…å®¹å†åå‘ä¿®æ”¹å›å»ï¼Œç‰ˆæœ¬ä¼šé€’å¢ï¼Œä¸å½±å“ä¹‹å‰æäº¤çš„å†…å®¹ã€‚

ğŸ“– **è¯­æ³•ï¼š**

```bash
# è¿˜åŸå‰ä¸€æ¬¡ commit
$ git revert HEAD

# è¿˜åŸå‰å‰ä¸€æ¬¡ commit
$ git revert HEAD^

# è¿˜åŸæŒ‡å®šç‰ˆæœ¬
$ git revert <commit-id>
```





---

**å‚è€ƒèµ„æ–™ï¼š**

* [ğŸ“ Git ç”±æµ…å…¥æ·±ä¹‹ç»†è¯´å˜åŸº](https://juejin.im/post/58f97793a22b9d00658b15b6)