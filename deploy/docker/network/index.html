<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/devops-guidebook/umi.css" />
    <script>
      window.routerBase = "/devops-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.9
    </script>
    <title>&#x7F51;&#x7EDC;&#x901A;&#x4FE1;</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/devops-icon.png&#x27;)" href="/devops-guidebook//">DevOps Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a href="/devops-guidebook//linux">Linux</a><a href="/devops-guidebook//server">服务器</a><a href="/devops-guidebook//data-base">数据库</a><a aria-current="page" class="active" href="/devops-guidebook//deploy">部署</a><a href="/devops-guidebook//code">代码管理</a><a href="/devops-guidebook//devops">DevOps</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/devops-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/devops-icon.png&#x27;)" href="/devops-guidebook//"></a><h1>DevOps Guidebook</h1><p>DevOps 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/devops-guidebook//linux">Linux</a></li><li><a href="/devops-guidebook//server">服务器</a></li><li><a href="/devops-guidebook//data-base">数据库</a></li><li><a aria-current="page" class="active" href="/devops-guidebook//deploy">部署</a></li><li><a href="/devops-guidebook//code">代码管理</a></li><li><a href="/devops-guidebook//devops">DevOps</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/devops-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/devops-guidebook//deploy/theory">部署理论</a><ul><li><a href="/devops-guidebook//deploy/theory"><span>基本概述</span></a></li><li><a href="/devops-guidebook//deploy/theory/environment"><span>环境区分</span></a></li><li><a href="/devops-guidebook//deploy/theory/continuous-integration"><span>持续集成</span></a></li><li><a href="/devops-guidebook//deploy/theory/continuous-dilivery"><span>持续交付</span></a></li><li><a href="/devops-guidebook//deploy/theory/continuous-deployment"><span>持续部署</span></a></li><li><a href="/devops-guidebook//deploy/theory/blue-green-deployment"><span>蓝绿部署</span></a></li><li><a href="/devops-guidebook//deploy/theory/gray-release"><span>灰度部署</span></a></li><li><a href="/devops-guidebook//deploy/theory/rolling-update"><span>滚动部署</span></a></li></ul></li><li><a aria-current="page" class="active" href="/devops-guidebook//deploy/docker">Docker</a><ul><li><a href="/devops-guidebook//deploy/docker/overview"><span>基本概述</span></a></li><li><a href="/devops-guidebook//deploy/docker/image"><span>构建镜像</span></a></li><li><a href="/devops-guidebook//deploy/docker/docker-file"><span>配置脚本</span></a></li><li><a href="/devops-guidebook//deploy/docker/container"><span>操作容器</span></a></li><li><a href="/devops-guidebook//deploy/docker/storage-patterns-for-persistence"><span>持久存储模式</span></a></li><li><a aria-current="page" class="active" href="/devops-guidebook//deploy/docker/network"><span>网络通信</span></a></li><li><a href="/devops-guidebook//deploy/docker/operations-and-monitor"><span>运维和监控</span></a></li><li><a href="/devops-guidebook//deploy/docker/docker-compose"><span>多容器部署</span></a></li><li><a href="/devops-guidebook//deploy/docker/command"><span>常用命令</span></a></li><li><a href="/devops-guidebook//deploy/docker/extensions"><span>扩展资源</span></a></li><li><a href="/devops-guidebook//deploy/docker/mongodb"><span>部署 MongoDB</span></a></li></ul></li><li><a href="/devops-guidebook//deploy/github-actions">Github-actions</a><ul><li><a href="/devops-guidebook//deploy/github-actions"><span>Github Actions</span></a></li></ul></li><li><a href="/devops-guidebook//deploy/jenkins">Jenkins</a></li><li><a href="/devops-guidebook//deploy/rancher">Rancher</a></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="网络模式类型" data-depth="2" class=""><a href="/devops-guidebook//deploy/docker/network#网络模式类型"><span>网络模式类型</span></a></li><li title="Bridge 模式" data-depth="3" class=""><a href="/devops-guidebook//deploy/docker/network#bridge-模式"><span>Bridge 模式</span></a></li><li title="Host 模式" data-depth="3" class=""><a href="/devops-guidebook//deploy/docker/network#host-模式"><span>Host 模式</span></a></li><li title="Container 模式" data-depth="3" class=""><a href="/devops-guidebook//deploy/docker/network#container-模式"><span>Container 模式</span></a></li><li title="None 模式" data-depth="3" class=""><a href="/devops-guidebook//deploy/docker/network#none-模式"><span>None 模式</span></a></li><li title="多容器通信" data-depth="2" class=""><a href="/devops-guidebook//deploy/docker/network#多容器通信"><span>多容器通信</span></a></li><li title="相关指令" data-depth="2" class=""><a href="/devops-guidebook//deploy/docker/network#相关指令"><span>相关指令</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="网络通信"><a aria-hidden="true" href="#网络通信"><span class="icon icon-link"></span></a>网络通信</h1><p>要实现网络通信，机器需要至少一个网络接口（物理接口或虚拟接口）来收发数据包；此外，如果不同子网之间要进行通信，需要路由机制。</p><p>Docker 中的网络接口默认都是虚拟的接口。虚拟接口的优势之一是转发效率较高。 Linux 通过在内核中进行数据复制来实现虚拟接口之间的数据转发，发送接口的发送缓存中的数据包被直接复制到接收接口的接收缓存中。对于本地系统和容器内系统看来就像是一个正常的以太网卡，只是它不需要真正同外部网络设备通信，速度要快很多。</p><p>Docker 容器网络就利用了这项技术。它在本地主机和容器内分别创建一个虚拟接口，并让它们彼此连通（这样的一对接口叫做 <code>veth pair</code>）。</p><p>Docker 中使用 Network 来管理容器之间的通信，只要两个 Conteiner 处于同一个 Network 之中，就可以通过容器名去互相通信。</p><h2 id="网络模式类型"><a aria-hidden="true" href="#网络模式类型"><span class="icon icon-link"></span></a>网络模式类型</h2><p>Docker 创建一个容器的时候，会执行如下操作：</p><ul><li>创建一对虚拟接口，分别放到本地主机和新容器中</li><li>本地主机一端桥接到默认的 <code>docker0</code> 或指定网桥上，并具有一个唯一的名字，如 <code>veth65f9</code></li><li>容器一端放到新容器中，并修改名字作为 <code>eth0</code>，这个接口 <strong>只在</strong> 容器的名字空间可见</li><li>从网桥可用地址段中获取一个空闲地址分配给容器的 <code>eth0</code>，并配置默认路由到桥接网卡 <code>veth65f9</code></li></ul><p>完成这些之后，容器就可以使用 <code>eth0</code> 虚拟网卡来连接其他容器和其他网络。</p><p>可以在 <code>docker run</code> 的时候通过 <code>--net</code> 参数来指定容器的网络配置，有四个可选值，下面逐个进行解释。</p><h3 id="bridge-模式"><a aria-hidden="true" href="#bridge-模式"><span class="icon icon-link"></span></a>Bridge 模式</h3><p>Bridge 模式（<code>--net=bridge</code>）为 Docker 容器默认创建后的网络模式，这中模式创建后即加入 <code>docker0</code> 网桥。其特点如下：</p><ul><li>使用一个 Linux bridge，默认为 <code>docker0</code></li><li>使用 veth 对，一头在容器的网络 namespace 中，一头在 <code>docker0</code> 上</li><li>该模式下 Docker Container 不具有一个公有 IP，因为宿主机的 IP 地址与 veth pair 的 IP 地址不在同一个网段内</li><li>Docker 采用 NAT 方式，将容器内部的服务监听的端口与宿主机的某一个端口 port 进行<strong>绑定</strong>，使得宿主机以外的世界可以主动将网络报文发送至容器内部</li><li>外界访问容器内的服务时，需要访问宿主机的 IP 以及宿主机的端口 port</li><li>NAT 模式由于是在三层网络上的实现手段，故肯定会影响网络的传输效率</li><li>容器拥有独立、隔离的网络栈；让容器和宿主机以外的世界通过 NAT 建立通信</li></ul><h3 id="host-模式"><a aria-hidden="true" href="#host-模式"><span class="icon icon-link"></span></a>Host 模式</h3><p>Host 模式（<code>--net=host</code>）并没有为容器创建一个隔离的网络环境（network namespace），这就意味着容器不会有自己的网卡信息，而是与宿主机共用网络环境，亦即拥有完全的本地主机接口的访问权限。</p><p>容器进程可以跟宿主机其他 root 进程一样打开低范围的端口，可以访问本地网络服务比如 D-Bus，还可以让容器做一些影响整个主机系统的事情。这种情况下，容器除了网络，其他都是隔离的。</p><p>此时容器内获取 IP 为宿主机 IP，端口绑定直接绑定在宿主机网卡上，有点是网络传输不用经过 NAT 转换，效率更高速度更快。</p><p>其特点包括：</p><ul><li>这种模式下的容器没有隔离的 network namespace</li><li>容器的 IP 地址同 Docker host（容器的宿主机）的 IP 地址</li><li>需要注意容器中服务的端口号不能与 Docker host 上已经使用的端口号相冲突</li><li>host 模式能够和其它模式共存</li></ul><h3 id="container-模式"><a aria-hidden="true" href="#container-模式"><span class="icon icon-link"></span></a>Container 模式</h3><p>Container 模式（<code>--net=container:&lt;NAME_OR_ID&gt;</code>）是 Docker 中一种较为特别的网络的模式。处于这个模式下的 Docker 容器会共享其他容器的网络环境（共享 network namespace），因此，至少这两个容器之间不存在网络隔离，而这两个容器又与宿主机以及除此之外其他的容器存在网络隔离。</p><p>两个容器有自己的文件系统、进程列表和资源限制，但会和已存在的容器共享 IP 地址和端口等网络资源，两者进程可以直接通过 I/O 环回接口通信。</p><h3 id="none-模式"><a aria-hidden="true" href="#none-模式"><span class="icon icon-link"></span></a>None 模式</h3><p>None 模式（<code>--net=none</code>），即容器获取独立的 network namespace，但不为容器进行任何网络配置，需要手动配置。一旦 Docker 容器采用了 none 网络模式，那么容器内部就只能使用 <code>loopback</code> 网络设备，不会再有其他的网络资源。Docker Container 的 none 网络模式意味着不给该容器创建任何网络环境，容器只能使用 <code>127.0.0.1</code> 的本机网络。</p><h2 id="多容器通信"><a aria-hidden="true" href="#多容器通信"><span class="icon icon-link"></span></a>多容器通信</h2><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text=" # 通过link指令建立连接
 $ docker run --name &lt;Name&gt; -d -p &lt;path1&gt;:&lt;path2&gt; --link &lt;containerName&gt;:&lt;alias&gt; &lt;containerName:tag/imageID&gt;

- --link 容器连接指令
- &lt; containerName &gt; : &lt; alias &gt;
- &lt; 被连接容器名称 &gt; : &lt; 容器访问别名 &gt;
- 注：别名在主动建立连接的容器中访问被连接容器使用
- 以下指令在容器检测连接状态
    $ curl &lt;alias&gt;
" data-status="copy"></button><div class="token-line"><span class="token plain"> </span><span class="token comment"># 通过link指令建立连接</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"> $ docker run --name </span><span class="token operator">&lt;</span><span class="token plain">Name</span><span class="token operator">&gt;</span><span class="token plain"> -d -p </span><span class="token operator">&lt;</span><span class="token plain">path</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">:</span><span class="token operator">&lt;</span><span class="token plain">path</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"> --link </span><span class="token operator">&lt;</span><span class="token plain">containerName</span><span class="token operator">&gt;</span><span class="token plain">:</span><span class="token operator">&lt;</span><span class="token plain">alias</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">containerName:tag/imageID</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">- --link 容器连接指令</span></div><div class="token-line"><span class="token plain">- </span><span class="token operator">&lt;</span><span class="token plain"> containerName </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token builtin class-name">alias</span><span class="token plain"> </span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">- </span><span class="token operator">&lt;</span><span class="token plain"> 被连接容器名称 </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain"> 容器访问别名 </span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">- 注：别名在主动建立连接的容器中访问被连接容器使用</span></div><div class="token-line"><span class="token plain">- 以下指令在容器检测连接状态</span></div><div class="token-line"><span class="token plain">    $ </span><span class="token function">curl</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">alias</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="相关指令"><a aria-hidden="true" href="#相关指令"><span class="icon icon-link"></span></a>相关指令</h2><p>Docker 中常用的 network 指令：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="$ docker network create

# 将容器 container-name 连接到新建网络 network-name
$ docker network connect &lt;network-name&gt; &lt;contaienr-name&gt;

$ docker network ls

# 将 container-name 从 network-name 网络中移除连接
$ docker network disconnect &lt;network-name&gt; &lt;container-name&gt;

# 与 disconnect 相似，但是要求容器关闭或断开与此网络的连接
$ docker network rm &lt;network-name&gt; &lt;container-name&gt;

# 查看容器的网络情况
$ docker network inspect &lt;container-name&gt;
" data-status="copy"></button><div class="token-line"><span class="token plain">$ docker network create</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 将容器 container-name 连接到新建网络 network-name</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ docker network connect </span><span class="token operator">&lt;</span><span class="token plain">network-name</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">contaienr-name</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ docker network </span><span class="token function">ls</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 将 container-name 从 network-name 网络中移除连接</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ docker network disconnect </span><span class="token operator">&lt;</span><span class="token plain">network-name</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">container-name</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 与 disconnect 相似，但是要求容器关闭或断开与此网络的连接</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ docker network </span><span class="token function">rm</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">network-name</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">container-name</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查看容器的网络情况</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ docker network inspect </span><span class="token operator">&lt;</span><span class="token plain">container-name</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><hr/><p><strong>参考资料：</strong></p><ul><li><a href="https://docs.docker.com/network/" target="_blank" rel="noopener noreferrer">📖 Docker：Networking overview<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://www.jianshu.com/p/9ea182393c0e" target="_blank" rel="noopener noreferrer">📝 Docker 系列教程 - network 命令<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://www.cnblogs.com/zzsdream/p/11193096.html" target="_blank" rel="noopener noreferrer">📝 Docker 网络实现<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/devops-guidebook/edit/master/docs/deploy/docker/network.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last Update: ">8/21/2020, 7:44:31 AM</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/devops-guidebook/umi.js"></script>
    <script src="/devops-guidebook/docs__deploy__docker__network.md.js"></script>
  </body>
</html>
