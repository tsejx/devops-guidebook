<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/devops-guidebook/umi.css" />
    <script>
      window.routerBase = "/devops-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.9
    </script>
    <title>&#x591A;&#x5BB9;&#x5668;&#x90E8;&#x7F72;</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/deploy/docker/docker-compose" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/devops-icon.png&#x27;)" href="/devops-guidebook//">DevOps Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a href="/devops-guidebook//linux">Linux</a></span><span><a href="/devops-guidebook//server">æœåŠ¡å™¨</a></span><span><a aria-current="page" class="active" href="/devops-guidebook//deploy">éƒ¨ç½²</a></span><span><a href="/devops-guidebook//code">ä»£ç ç®¡ç†</a></span><span><a href="/devops-guidebook//devops">DevOps</a></span><span><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/devops-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/devops-icon.png&#x27;)" href="/devops-guidebook//"></a><h1>DevOps Guidebook</h1><p>DevOps å®Œå…¨çŸ¥è¯†ä½“ç³»</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/devops-guidebook//linux">Linux</a></li><li><a href="/devops-guidebook//server">æœåŠ¡å™¨</a></li><li><a aria-current="page" class="active" href="/devops-guidebook//deploy">éƒ¨ç½²</a></li><li><a href="/devops-guidebook//code">ä»£ç ç®¡ç†</a></li><li><a href="/devops-guidebook//devops">DevOps</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/devops-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/devops-guidebook//deploy/theory">éƒ¨ç½²ç†è®º</a><ul><li><a href="/devops-guidebook//deploy/theory"><span>åŸºæœ¬æ¦‚è¿°</span></a></li><li><a href="/devops-guidebook//deploy/theory/environment"><span>ç¯å¢ƒåŒºåˆ†</span></a></li><li><a href="/devops-guidebook//deploy/theory/continuous-integration"><span>æŒç»­é›†æˆ</span></a></li><li><a href="/devops-guidebook//deploy/theory/continuous-dilivery"><span>æŒç»­äº¤ä»˜</span></a></li><li><a href="/devops-guidebook//deploy/theory/continuous-deployment"><span>æŒç»­éƒ¨ç½²</span></a></li><li><a href="/devops-guidebook//deploy/theory/blue-green-deployment"><span>è“ç»¿éƒ¨ç½²</span></a></li><li><a href="/devops-guidebook//deploy/theory/gray-release"><span>ç°åº¦éƒ¨ç½²</span></a></li><li><a href="/devops-guidebook//deploy/theory/rolling-update"><span>æ»šåŠ¨éƒ¨ç½²</span></a></li></ul></li><li><a aria-current="page" class="active" href="/devops-guidebook//deploy/docker">Docker</a><ul><li><a href="/devops-guidebook//deploy/docker/overview"><span>åŸºæœ¬æ¦‚è¿°</span></a></li><li><a href="/devops-guidebook//deploy/docker/image"><span>æ„å»ºé•œåƒ</span></a></li><li><a href="/devops-guidebook//deploy/docker/docker-file"><span>é…ç½®è„šæœ¬</span></a></li><li><a href="/devops-guidebook//deploy/docker/container"><span>æ“ä½œå®¹å™¨</span></a></li><li><a href="/devops-guidebook//deploy/docker/storage-patterns-for-persistence"><span>æŒä¹…å­˜å‚¨æ¨¡å¼</span></a></li><li><a href="/devops-guidebook//deploy/docker/network"><span>ç½‘ç»œé€šä¿¡</span></a></li><li><a href="/devops-guidebook//deploy/docker/operations-and-monitor"><span>è¿ç»´å’Œç›‘æ§</span></a></li><li><a aria-current="page" class="active" href="/devops-guidebook//deploy/docker/docker-compose"><span>å¤šå®¹å™¨éƒ¨ç½²</span></a></li><li><a href="/devops-guidebook//deploy/docker/command"><span>å¸¸ç”¨å‘½ä»¤</span></a></li><li><a href="/devops-guidebook//deploy/docker/extensions"><span>æ‰©å±•èµ„æº</span></a></li><li><a href="/devops-guidebook//deploy/docker/mongodb"><span>éƒ¨ç½² MongoDB</span></a></li></ul></li><li><a href="/devops-guidebook//deploy/github-actions">Github-actions</a><ul><li><a href="/devops-guidebook//deploy/github-actions"><span>Github Actions</span></a></li></ul></li><li><a href="/devops-guidebook//deploy/jenkins">Jenkins</a></li><li><a href="/devops-guidebook//deploy/rancher">Rancher</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="æ¨¡ç‰ˆæ–‡ä»¶" data-depth="2"><a href="/devops-guidebook//deploy/docker/docker-compose#æ¨¡ç‰ˆæ–‡ä»¶"><span>æ¨¡ç‰ˆæ–‡ä»¶</span></a></li><li title="é¡¶å±‚ç»“æ„" data-depth="3"><a href="/devops-guidebook//deploy/docker/docker-compose#é¡¶å±‚ç»“æ„"><span>é¡¶å±‚ç»“æ„</span></a></li><li title="image" data-depth="3"><a href="/devops-guidebook//deploy/docker/docker-compose#image"><span>image</span></a></li><li title="build" data-depth="3"><a href="/devops-guidebook//deploy/docker/docker-compose#build"><span>build</span></a></li><li title="depends_on" data-depth="3"><a href="/devops-guidebook//deploy/docker/docker-compose#depends_on"><span>depends_on</span></a></li><li title="env_file" data-depth="3"><a href="/devops-guidebook//deploy/docker/docker-compose#env_file"><span>env_file</span></a></li><li title="environment" data-depth="3"><a href="/devops-guidebook//deploy/docker/docker-compose#environment"><span>environment</span></a></li><li title="secrets" data-depth="3"><a href="/devops-guidebook//deploy/docker/docker-compose#secrets"><span>secrets</span></a></li><li title="expose" data-depth="3"><a href="/devops-guidebook//deploy/docker/docker-compose#expose"><span>expose</span></a></li><li title="ports" data-depth="3"><a href="/devops-guidebook//deploy/docker/docker-compose#ports"><span>ports</span></a></li><li title="network_mode" data-depth="3"><a href="/devops-guidebook//deploy/docker/docker-compose#network_mode"><span>network_mode</span></a></li><li title="networks" data-depth="3"><a href="/devops-guidebook//deploy/docker/docker-compose#networks"><span>networks</span></a></li><li title="volumes" data-depth="3"><a href="/devops-guidebook//deploy/docker/docker-compose#volumes"><span>volumes</span></a></li><li title="labels" data-depth="3"><a href="/devops-guidebook//deploy/docker/docker-compose#labels"><span>labels</span></a></li><li title="command" data-depth="3"><a href="/devops-guidebook//deploy/docker/docker-compose#command"><span>command</span></a></li><li title="å…¶ä»–æŒ‡ä»¤" data-depth="3"><a href="/devops-guidebook//deploy/docker/docker-compose#å…¶ä»–æŒ‡ä»¤"><span>å…¶ä»–æŒ‡ä»¤</span></a></li><li title="å‘½ä»¤è¡ŒæŒ‡ä»¤" data-depth="2"><a href="/devops-guidebook//deploy/docker/docker-compose#å‘½ä»¤è¡ŒæŒ‡ä»¤"><span>å‘½ä»¤è¡ŒæŒ‡ä»¤</span></a></li><li title="up" data-depth="3"><a href="/devops-guidebook//deploy/docker/docker-compose#up"><span>up</span></a></li><li title="build" data-depth="3"><a href="/devops-guidebook//deploy/docker/docker-compose#build-1"><span>build</span></a></li><li title="exec" data-depth="3"><a href="/devops-guidebook//deploy/docker/docker-compose#exec"><span>exec</span></a></li><li title="ç¯å¢ƒå˜é‡" data-depth="2"><a href="/devops-guidebook//deploy/docker/docker-compose#ç¯å¢ƒå˜é‡"><span>ç¯å¢ƒå˜é‡</span></a></li><li title="æŠŠç¯å¢ƒå˜é‡ä¼ é€’ç»™å®¹å™¨" data-depth="3"><a href="/devops-guidebook//deploy/docker/docker-compose#æŠŠç¯å¢ƒå˜é‡ä¼ é€’ç»™å®¹å™¨"><span>æŠŠç¯å¢ƒå˜é‡ä¼ é€’ç»™å®¹å™¨</span></a></li><li title="ç¯å¢ƒå˜é‡æ–‡ä»¶" data-depth="3"><a href="/devops-guidebook//deploy/docker/docker-compose#ç¯å¢ƒå˜é‡æ–‡ä»¶"><span>ç¯å¢ƒå˜é‡æ–‡ä»¶</span></a></li><li title="é…ç½®ä¸åŒåœºæ™¯ä¸‹çš„ç¯å¢ƒå˜é‡" data-depth="3"><a href="/devops-guidebook//deploy/docker/docker-compose#é…ç½®ä¸åŒåœºæ™¯ä¸‹çš„ç¯å¢ƒå˜é‡"><span>é…ç½®ä¸åŒåœºæ™¯ä¸‹çš„ç¯å¢ƒå˜é‡</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="å¤šå®¹å™¨éƒ¨ç½²"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/docker-compose#å¤šå®¹å™¨éƒ¨ç½²"><span class="icon,icon-link"></span></a>å¤šå®¹å™¨éƒ¨ç½²</h1><p>Docker Composeï¼ˆå¤šå®¹å™¨éƒ¨ç½²ï¼‰æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œè¿™ä¸ªå·¥å…·å¯ä»¥é€šè¿‡ä¸€ä¸ª YML æ–‡ä»¶å®šä¹‰å¤šå®¹å™¨çš„ Docker åº”ç”¨ã€‚é€šè¿‡ä¸€æ¡å‘½ä»¤å°±å¯ä»¥æ ¹æ® YML æ–‡ä»¶çš„å®šä¹‰å»åˆ›å»ºæˆ–è€…ç®¡ç†å¤šä¸ªå®¹å™¨ã€‚</p><h2 id="æ¨¡ç‰ˆæ–‡ä»¶"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/docker-compose#æ¨¡ç‰ˆæ–‡ä»¶"><span class="icon,icon-link"></span></a>æ¨¡ç‰ˆæ–‡ä»¶</h2><p>æ¨¡ç‰ˆæ–‡ä»¶æ˜¯ä½¿ç”¨ Compose çš„æ ¸å‹ï¼Œè®¾è®¡åˆ°çš„æŒ‡ä»¤å…³é”®å­—è¾ƒå¤šã€‚ä½†æ˜¯å¤§éƒ¨åˆ†æŒ‡ä»¤ä¸ <code>docker run</code> ç›¸å…³å‚æ•°çš„å«ä¹‰éƒ½æ˜¯ç±»ä¼¼çš„ã€‚</p><p>é»˜è®¤çš„æ¨¡ç‰ˆæ–‡ä»¶åç§°ä¸º <code>docker-compose.yml</code>ï¼Œæ ¼å¼ä¸º YAML æ ¼å¼ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-yml"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token key atrule">version</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;3&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">webapp</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation">:</span><span class="token plain"> examples/web</span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">-</span><span class="token plain"> </span><span class="token string">&#x27;80:80&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">-</span><span class="token plain"> </span><span class="token string">&#x27;/data&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>âš ï¸ æ³¨æ„æ¯ä¸ªæœåŠ¡éƒ½å¿…é¡»é€šè¿‡ <code>image</code> æŒ‡ä»¤æŒ‡å®šé•œåƒæˆ– <code>build</code> æŒ‡ä»¤ï¼ˆéœ€è¦ Dockerfileï¼‰ç­‰æ¥è‡ªåŠ¨æ„å»ºç”Ÿæˆé•œåƒã€‚</p><p>å¦‚æœä½¿ç”¨ <code>build</code> æŒ‡ä»¤ï¼Œåœ¨ Dockerfile ä¸­è®¾ç½®çš„é€‰é¡¹ï¼ˆä¾‹å¦‚ï¼š<code>CMD</code>ã€<code>EXPOSE</code>ã€<code>VOLUME</code> å’Œ <code>ENV</code> ç­‰ï¼‰å°†ä¼šè‡ªåŠ¨è¢«è·å–ï¼Œæ— éœ€åœ¨ <code>docker-compose.yml</code> ä¸­é‡å¤è®¾ç½®ã€‚</p><p>ä¸‹é¢ç½—åˆ—äº†å¸¸ç”¨çš„æ¨¡ç‰ˆæ–‡ä»¶æŒ‡ä»¤é…ç½®é¡¹ï¼Œè¯¦ç»†çš„é…ç½®é¡¹å‚è€ƒ <a target="_blank" rel="noopener noreferrer" href="https://docs.docker.com/compose/compose-file/">ğŸ“– Compose file reference for Version 3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼Œæˆ–è€… <a target="_blank" rel="noopener noreferrer" href="https://yeasy.gitbooks.io/docker_practice/content/compose/compose_file.html">Docker å®æˆ˜æ‰‹å†Œï¼šæ¨¡ç‰ˆæ–‡ä»¶<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ã€‚</p><h3 id="é¡¶å±‚ç»“æ„"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/docker-compose#é¡¶å±‚ç»“æ„"><span class="icon,icon-link"></span></a>é¡¶å±‚ç»“æ„</h3><p>é¡¶å±‚ç»“æ„ç”± <code>version</code>ã€<code>services</code>ã€<code>networks</code> å’Œ <code>volumes</code> ç­‰ç­‰æ ‡ç­¾æ„æˆã€‚</p><p><strong>services</strong></p><ul><li>ä¸€ä¸ª service ä»£è¡¨ä¸€ä¸ª containerï¼Œè¿™ä¸ª container å¯ä»¥ä» dockerHub ä¸­çš„é•œåƒæ¥åˆ›å»ºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æœ¬åœ° dockerfile build å‡ºæ¥çš„é•œåƒæ¥åˆ›å»º</li><li>service çš„å¯åŠ¨ç±»ä¼¼ docker runï¼Œå¯ä»¥ç»™ service æŒ‡å®š network å’Œ volume çš„å¼•ç”¨</li></ul><h3 id="image"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/docker-compose#image"><span class="icon,icon-link"></span></a>image</h3><p>æŒ‡å®šä¸ºé•œåƒåç§°æˆ–é•œåƒ IDã€‚å¦‚æœé•œåƒåœ¨æœ¬åœ°ä¸å­˜åœ¨ï¼ŒCompose å°†ä¼šå°è¯•æ‹‰å–è¿™ä¸ªé•œåƒã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-yml"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token key atrule">image</span><span class="token punctuation">:</span><span class="token plain"> ubuntu</span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">image</span><span class="token punctuation">:</span><span class="token plain"> orchardup/postgresql</span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">image</span><span class="token punctuation">:</span><span class="token plain"> a4bc65fd</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="build"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/docker-compose#build"><span class="icon,icon-link"></span></a>build</h3><p>åŸºäº Dockerfileï¼ŒæŒ‡å®š Dockerfile æ‰€åœ¨è·¯å¾„ï¼ŒCompose ä¼šåˆ©ç”¨å®ƒè‡ªåŠ¨æ„å»ºé•œåƒï¼Œç„¶åå¯åŠ¨æœåŠ¡å®¹å™¨ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-yml"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># ç»å¯¹è·¯å¾„</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">build</span><span class="token punctuation">:</span><span class="token plain"> /path/build</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># ç›¸å¯¹è·¯å¾„</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">build</span><span class="token punctuation">:</span><span class="token plain"> ./dir</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># è®¾å®šä¸Šä¸‹æ–‡å’Œç›®å½•ï¼Œä»¥æ­¤ç›®å½•æŒ‡å®š Dockerfile</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">build</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">context</span><span class="token punctuation">:</span><span class="token plain"> ../</span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">dockerfile</span><span class="token punctuation">:</span><span class="token plain"> path/dockerfile</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># ç»™ Dockerfile æ„å»ºçš„é•œåƒå‘½å</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">build</span><span class="token punctuation">:</span><span class="token plain"> ./dir</span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">images</span><span class="token punctuation">:</span><span class="token plain"> nginx</span><span class="token punctuation">:</span><span class="token plain">latest</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># æ„å»ºè¿‡ç¨‹ä¸­æŒ‡å®šç¯å¢ƒå˜é‡ï¼Œæ„å»ºæˆåŠŸåå–æ¶ˆ</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># ä¸ EVN ä¸åŒ ARG å…è®¸ç©ºå€¼</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">build</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">context</span><span class="token punctuation">:</span><span class="token plain"> ./dir</span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">dockerfile</span><span class="token punctuation">:</span><span class="token plain"> Dockerfile</span><span class="token punctuation">-</span><span class="token plain">alternate</span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">args</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">buildno</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">password</span><span class="token punctuation">:</span><span class="token plain"> secret</span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">caceh_form</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">-</span><span class="token plain"> alpine</span><span class="token punctuation">:</span><span class="token plain">latest</span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">-</span><span class="token plain"> corp/web_app</span><span class="token punctuation">:</span><span class="token number">3.14</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><ul><li><code>context</code>ï¼šè·¯å¾„</li><li><code>dockerfile</code>ï¼šéœ€è¦æ›¿æ¢é»˜è®¤ <code>docker-compose</code> çš„æ–‡ä»¶å</li><li><code>args</code>ï¼šä¸ºæ„å»ºï¼ˆbuildï¼‰è¿‡ç¨‹çš„ç¯å¢ƒå˜é‡ï¼Œç”¨äºæ›¿æ¢ Dockerfile é‡Œå®šä¹‰çš„ ARG å‚æ•°ï¼Œå®¹å™¨ä¸­ä¸å¯ç”¨</li><li><code>cache_from</code>ï¼šæŒ‡å®šæ„å»ºé•œåƒçš„ç¼“å­˜</li></ul><h3 id="depends_on"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/docker-compose#depends_on"><span class="icon,icon-link"></span></a>depends_on</h3><p>è§£å†³å®¹å™¨çš„ä¾èµ–ã€å¯åŠ¨å…ˆåé—®é¢˜ã€‚</p><p>ğŸŒ° <strong>ç¤ºä¾‹ï¼š</strong></p><p>ä»¥ä¸‹ä¾‹å­ä¼šå…ˆå¯åŠ¨ <code>redis</code> å’Œ <code>db</code> å†å¯åŠ¨ <code>web</code></p><div class="__dumi-default-code-block"><pre class="prism-code language-yml"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token key atrule">version</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;3&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">web</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">build</span><span class="token punctuation">:</span><span class="token plain"> .</span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">depends_on</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">-</span><span class="token plain"> db</span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">-</span><span class="token plain"> redis</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">redis</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation">:</span><span class="token plain"> redis</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">db</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation">:</span><span class="token plain"> postgres</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><blockquote><p>âš ï¸ <strong>æ³¨æ„ï¼š</strong> <code>web</code> æœåŠ¡ä¸ä¼šç­‰å¾… æ•°æ®åº“ï¼ˆä¾‹å¦‚ <code>redis</code> å’Œ <code>db</code>ï¼‰å®Œå…¨å¯åŠ¨ä¹‹åæ‰å¯åŠ¨ï¼Œä¹Ÿå°±æ˜¯ <code>depends_on</code> åªæ˜¯å†³å®šå¼€å¯é¡ºåºï¼Œå®¹å™¨å†…æ•°æ®åº“æ˜¯å¦å·²ç»åˆå§‹åŒ–å¯åŠ¨å®Œæ¯•å Web æœåŠ¡æ‰èƒ½è¿æ¥ä¸Šï¼Œè¿™é‡Œæ˜¯å¾ˆå‘çš„ä¸€ä¸ªåœ°æ–¹ã€‚</p></blockquote><p><strong>è§£å†³æ–¹æ³•</strong></p><p>å¯èƒ½å®˜æ–¹ä¹ŸçŸ¥é“è¿™é‡Œå¾ˆå‘ï¼Œå®˜æ–¹æ–‡æ¡£ä¸­ç»™å‡ºäº†è§£å†³æ–¹æ¡ˆï¼ˆ<a target="_blank" rel="noopener noreferrer" href="https://docs.docker.com/compose/startup-order/">startup-order<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼‰ã€‚</p><h3 id="env_file"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/docker-compose#env_file"><span class="icon,icon-link"></span></a>env_file</h3><p>ä»æ–‡ä»¶ä¸­è·å–ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥ä¸ºå•ç‹¬çš„æ–‡ä»¶è·¯å¾„æˆ–åˆ—è¡¨ã€‚</p><p>å¦‚æœé€šè¿‡ <code>docker-compose -f FILE</code> æ–¹å¼æ¥æŒ‡å®š Compose æ¨¡æ¿æ–‡ä»¶ï¼Œåˆ™ <code>env_file</code> ä¸­å˜é‡çš„è·¯å¾„ä¼šåŸºäºæ¨¡æ¿æ–‡ä»¶è·¯å¾„ã€‚</p><p>å¦‚æœæœ‰å˜é‡åç§°ä¸ <code>environment</code> æŒ‡ä»¤å†²çªï¼Œåˆ™æŒ‰ç…§æƒ¯ä¾‹ï¼Œä»¥åè€…ä¸ºå‡†ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-yml"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># è‹¥ä¸ environment æŒ‡ä»¤å†²çªï¼Œä»¥åè€…ä¸ºå‡†</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">env_file</span><span class="token punctuation">:</span><span class="token plain"> .env</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># å¯è®¾ç½®å¤šä¸ª</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># æ­¤å˜é‡ä¸å¯¹ build æ„å»ºè¿‡ç¨‹ç”Ÿæ•ˆ</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">env_file</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">-</span><span class="token plain"> ./common.env</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">-</span><span class="token plain"> ./apps/web.env</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">-</span><span class="token plain"> /opt/secrets.env</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>ç¯å¢ƒå˜é‡æ–‡ä»¶ä¸­æ¯ä¸€è¡Œå¿…é¡»ç¬¦åˆæ ¼å¼ï¼Œæ”¯æŒ # å¼€å¤´çš„æ³¨é‡Šè¡Œã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-yml"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># common.env: Set development environment</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">PROG_ENV=development</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="environment"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/docker-compose#environment"><span class="icon,icon-link"></span></a>environment</h3><p>è®¾ç½®ç¯å¢ƒå˜é‡ã€‚ä½ å¯ä»¥ä½¿ç”¨<strong>æ•°ç»„</strong>æˆ–<strong>å­—å…¸</strong>ä¸¤ç§æ ¼å¼ã€‚</p><p>åªç»™å®šåç§°çš„å˜é‡ä¼šè‡ªåŠ¨è·å–è¿è¡Œ Compose ä¸»æœºä¸Šå¯¹åº”å˜é‡çš„å€¼ï¼Œå¯ä»¥ç”¨æ¥é˜²æ­¢æ³„éœ²ä¸å¿…è¦çš„æ•°æ®ã€‚</p><p>å¯åŠ¨åçš„å®¹å™¨ä¼šåŒ…å«è¿™äº›å˜é‡è®¾ç½®ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-yml"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token key atrule">environment</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">RACK_ENV</span><span class="token punctuation">:</span><span class="token plain"> development</span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">SESSION_SECRET</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">environment</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">-</span><span class="token plain"> RACK_ENV=development</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">-</span><span class="token plain"> SESSION_SECRET</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>å¦‚æœå˜é‡åç§°æˆ–è€…å€¼ä¸­ç”¨åˆ° <code>true|false</code>ï¼Œ<code>yes|no</code> ç­‰è¡¨è¾¾ <strong>å¸ƒå°”</strong> å«ä¹‰çš„è¯æ±‡ï¼Œæœ€å¥½æ”¾åˆ°å¼•å·é‡Œï¼Œé¿å… YAML è‡ªåŠ¨è§£ææŸäº›å†…å®¹ä¸ºå¯¹åº”çš„å¸ƒå°”è¯­ä¹‰ã€‚è¿™äº›ç‰¹å®šè¯æ±‡ï¼ŒåŒ…æ‹¬</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">y|Y|yes|Yes|YES|n|N|no|No|NO|true|True|TRUE|false|False|FALSE|on|On|ON|off|Off|OFF</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="secrets"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/docker-compose#secrets"><span class="icon,icon-link"></span></a>secrets</h3><p>å­˜å‚¨æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚ mysql æœåŠ¡å¯†ç ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-yml"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token key atrule">version</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;3.1&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">mysql</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">image</span><span class="token punctuation">:</span><span class="token plain"> mysql</span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">environment</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">MYSQL_ROOT_PASSWORD_FILE</span><span class="token punctuation">:</span><span class="token plain"> /run/secrets/db_root_password</span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">secrets</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">-</span><span class="token plain"> db_root_password</span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">-</span><span class="token plain"> my_other_secret</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">secrets</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">my_secret</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">file</span><span class="token punctuation">:</span><span class="token plain"> ./my_secret.txt</span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">my_other_secret</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">external</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="expose"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/docker-compose#expose"><span class="icon,icon-link"></span></a>expose</h3><p>æš´éœ²ç«¯å£ï¼Œä½†ä¸æ˜ å°„åˆ°å®¿ä¸»æœºï¼Œåªè¢«è¿æ¥çš„æœåŠ¡è®¿é—®ã€‚</p><p>ä»…å¯ä»¥æŒ‡å®šå†…éƒ¨ç«¯å£ä¸ºå‚æ•°</p><div class="__dumi-default-code-block"><pre class="prism-code language-yml"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token key atrule">expose</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">-</span><span class="token plain"> </span><span class="token string">&#x27;3000&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">-</span><span class="token plain"> </span><span class="token string">&#x27;8000&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="ports"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/docker-compose#ports"><span class="icon,icon-link"></span></a>ports</h3><p>æš´éœ²ç«¯å£ä¿¡æ¯ã€‚</p><p>ä½¿ç”¨ <code>å®¿ä¸»ç«¯å£ï¼šå®¹å™¨ç«¯å£</code> (<code>HOST:CONTAINER</code>) æ ¼å¼ï¼Œæˆ–è€…ä»…ä»…æŒ‡å®šå®¹å™¨çš„ç«¯å£ï¼ˆå®¿ä¸»å°†ä¼šéšæœºé€‰æ‹©ç«¯å£ï¼‰éƒ½å¯ä»¥ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-yml"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token key atrule">ports</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">-</span><span class="token plain"> </span><span class="token string">&#x27;3000&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">-</span><span class="token plain"> </span><span class="token string">&#x27;8000:8000&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">-</span><span class="token plain"> </span><span class="token string">&#x27;49100:22&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">-</span><span class="token plain"> </span><span class="token string">&#x27;127.0.0.1:8001:8001&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>âš ï¸ <strong>æ³¨æ„</strong>ï¼šå½“ä½¿ç”¨ <code>HOST:CONTAINER</code> æ ¼å¼æ¥æ˜ å°„ç«¯å£æ—¶ï¼Œå¦‚æœä½ ä½¿ç”¨çš„å®¹å™¨ç«¯å£å°äº 60 å¹¶ä¸”æ²¡æ”¾åˆ°å¼•å·é‡Œï¼Œå¯èƒ½ä¼šå¾—åˆ°é”™è¯¯ç»“æœï¼Œå› ä¸º YAML ä¼šè‡ªåŠ¨è§£æ <code>xx:yy</code> è¿™ç§æ•°å­—æ ¼å¼ä¸º 60 è¿›åˆ¶ã€‚ä¸ºé¿å…å‡ºç°è¿™ç§é—®é¢˜ï¼Œå»ºè®®æ•°å­—ä¸²éƒ½é‡‡ç”¨å¼•å·åŒ…æ‹¬èµ·æ¥çš„å­—ç¬¦ä¸²æ ¼å¼ã€‚</p><h3 id="network_mode"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/docker-compose#network_mode"><span class="icon,icon-link"></span></a>network_mode</h3><p>è®¾ç½®ç½‘ç»œæ¨¡å¼ã€‚ä½¿ç”¨å’Œ <code>docker run</code> çš„ <code>--network</code> å‚æ•°ä¸€æ ·çš„å€¼ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-yml"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token key atrule">network_mode</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&quot;bridge&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">network_mode</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&quot;host&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">network_mode</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&quot;none&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">network_mode</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&quot;service:[service name]&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">network_mode</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&quot;container:[container name/id]&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="networks"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/docker-compose#networks"><span class="icon,icon-link"></span></a>networks</h3><p>é…ç½®å®¹å™¨è¿æ¥çš„ç½‘ç»œã€‚ç›¸å½“äºæ‰§è¡Œ <code>docker network create xxx</code>ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-yml"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token key atrule">version</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;3&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">some-service</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">networks</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">-</span><span class="token plain"> some</span><span class="token punctuation">-</span><span class="token plain">network</span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">-</span><span class="token plain"> other</span><span class="token punctuation">-</span><span class="token plain">network</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">networks</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">some-network</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">other-network</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="volumes"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/docker-compose#volumes"><span class="icon,icon-link"></span></a>volumes</h3><p>æ•°æ®å·æ‰€æŒ‚è½½è·¯å¾„è®¾ç½®ã€‚å¯ä»¥è®¾ç½®ä¸ºå®¿ä¸»æœºè·¯å¾„ï¼ˆ<code>HOST:CONTAINER</code>ï¼‰æˆ–è€…æ•°æ®å·åç§°ï¼ˆ<code>VOLUME:CONTAINER</code>ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥è®¾ç½®è®¿é—®æ¨¡å¼ ï¼ˆ<code>HOST:CONTAINER:ro</code>ï¼‰ã€‚</p><p>ç›¸å½“äºæ‰§è¡Œ <code>docker volume create xxx</code>ã€‚</p><p>è¯¥æŒ‡ä»¤ä¸­è·¯å¾„æ”¯æŒç›¸å¯¹è·¯å¾„ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-yml"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token key atrule">volumes</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment"># åªæŒ‡å®šä¸€ä¸ªè·¯å¾„ï¼ŒDocker ä¼šè‡ªåŠ¨åœ¨åˆ›å»ºä¸€ä¸ªæ•°æ®å·ï¼ˆè¿™ä¸ªè·¯å¾„æ˜¯å®¹å™¨å†…éƒ¨çš„ï¼‰</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">-</span><span class="token plain"> /var/lib/mysql</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment"># ä½¿ç”¨ç»å¯¹è·¯å¾„æŒ‚åœ¨æ•°æ®å·</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">-</span><span class="token plain"> /opt/data</span><span class="token punctuation">:</span><span class="token plain">/var/lib/mysql</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment"># ä»¥ Compose é…ç½®æ–‡ä»¶ä¸ºä¸­å¿ƒçš„ç›¸å¯¹è·¯å¾„ä½œä¸ºæ•°æ®å·æŒ‚è½½åˆ°å®¹å™¨ã€‚</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">-</span><span class="token plain"> ./cache</span><span class="token punctuation">:</span><span class="token plain">/tmp/cache</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment"># ä½¿ç”¨ç”¨æˆ·çš„ç›¸å¯¹è·¯å¾„ï¼ˆ~/ è¡¨ç¤ºç›®å½•æ˜¯ /home/&lt;ç”¨æˆ·ç›®å½•&gt;/ æˆ–è€… /root/ï¼‰</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">-</span><span class="token plain"> ~/configs</span><span class="token punctuation">:</span><span class="token plain">/etc/configs/</span><span class="token punctuation">:</span><span class="token plain">ro</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment"># å·²ç»å­˜åœ¨çš„å‘½ä»¤çš„æ•°æ®å·</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">-</span><span class="token plain"> datavolume</span><span class="token punctuation">:</span><span class="token plain">/var/lib/mysql</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>å¦‚æœè·¯å¾„ä¸ºæ•°æ®å·åç§°ï¼Œå¿…é¡»åœ¨æ–‡ä»¶ä¸­é…ç½®æ•°æ®å·ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-yml"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token key atrule">version</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;3&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">my_src</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation">:</span><span class="token plain"> mysql</span><span class="token punctuation">:</span><span class="token number">8.0</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">-</span><span class="token plain"> mysql_data</span><span class="token punctuation">:</span><span class="token plain">/var/lib/mysql</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">volumes</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">mysql_data</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="labels"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/docker-compose#labels"><span class="icon,icon-link"></span></a>labels</h3><p>ä¸ºå®¹å™¨æ·»åŠ  Docker å…ƒæ•°æ®ï¼ˆmetadataï¼‰ä¿¡æ¯ã€‚ä¾‹å¦‚å¯ä»¥ä¸ºå®¹å™¨æ·»åŠ è¾…åŠ©è¯´æ˜ä¿¡æ¯ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-yml"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token key atrule">labels</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">com.startupteam.description</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;webapp for a startup team&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">com.startupteam.department</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;devops department&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">com.startupteam.release</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;rc3 for v1.0&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="command"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/docker-compose#command"><span class="icon,icon-link"></span></a>command</h3><p>è¦†ç›–å®¹å™¨å¯åŠ¨åé»˜è®¤æ‰§è¡Œçš„å‘½ä»¤</p><div class="__dumi-default-code-block"><pre class="prism-code language-yml"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token key atrule">command</span><span class="token punctuation">:</span><span class="token plain"> bundle exec thin </span><span class="token punctuation">-</span><span class="token plain">p 3000</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># æˆ– å†™æˆ exec å½¢å¼</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">command</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">bundle exec thin </span><span class="token punctuation">-</span><span class="token plain">p</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3000</span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="å…¶ä»–æŒ‡ä»¤"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/docker-compose#å…¶ä»–æŒ‡ä»¤"><span class="icon,icon-link"></span></a>å…¶ä»–æŒ‡ä»¤</h3><div class="__dumi-default-code-block"><pre class="prism-code language-yml"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># æŒ‡å®šå®¹å™¨åç§°ï¼Œé»˜è®¤ä½¿ç”¨ `é¡¹ç›®åç§°_æœåŠ¡åç§°_åºå·` è¿™æ ·çš„æ ¼å¼</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">container_name</span><span class="token punctuation">:</span><span class="token plain"> docker</span><span class="token punctuation">-</span><span class="token plain">container</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># æŒ‡å®šè®¾å¤‡æ˜ å°„å…³ç³»</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">devices</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">-</span><span class="token plain"> </span><span class="token string">&quot;/dev/ttyUSB0:/dev/ttyUSB0&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># è‡ªå®šä¹‰ DNS æœåŠ¡å™¨ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªå€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåˆ—è¡¨</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">dns</span><span class="token punctuation">:</span><span class="token plain"> 8.8.8.8</span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">dns</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">-</span><span class="token plain"> 8.8.8.8</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">-</span><span class="token plain"> 9.9.9.9</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># é…ç½® DNS æœç´¢åŸŸï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªå€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåˆ—è¡¨</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">dns_search</span><span class="token punctuation">:</span><span class="token plain"> example.com</span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">dns_search</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">-</span><span class="token plain"> dc1.example.com</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">-</span><span class="token plain"> dc2.example.com</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># é…ç½®æ—¥å¿—é€‰é¡¹</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">logging</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">driver</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&quot;syslog&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">options</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">syslog-address</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&quot;tcp://192.168.0.42:123&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># æŒ‡å®šæœåŠ¡å®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„å…¥å£æ–‡ä»¶</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">entrypoint</span><span class="token punctuation">:</span><span class="token plain"> /code/entrypoint.sh</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># æŒ‡å®šå®¹å™¨ä¸­è¿è¡Œåº”ç”¨çš„ç”¨æˆ·å</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">user</span><span class="token punctuation">:</span><span class="token plain"> postgresql</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># æŒ‡å®šå®¹å™¨ä¸­å·¥ä½œç›®å½•</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">working_dir</span><span class="token punctuation">:</span><span class="token plain"> /code</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># æŒ‚åœ¨ä¸´æ—¶ç›®å½•åˆ°å®¹å™¨å†…éƒ¨ï¼Œä¸ run å‚æ•°æ•ˆæœä¸€è‡´</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">tmpfs</span><span class="token punctuation">:</span><span class="token plain"> /run</span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">tmpfs</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">-</span><span class="token plain"> /run</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">-</span><span class="token plain"> /tmp</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># è¿æ¥åˆ°å…¶ä»–æœåŠ¡å™¨ä¸­çš„å®¹å™¨</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">links</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">-</span><span class="token plain"> db</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">-</span><span class="token plain"> db</span><span class="token punctuation">:</span><span class="token plain">mysql</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">-</span><span class="token plain"> redis</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="å‘½ä»¤è¡ŒæŒ‡ä»¤"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/docker-compose#å‘½ä»¤è¡ŒæŒ‡ä»¤"><span class="icon,icon-link"></span></a>å‘½ä»¤è¡ŒæŒ‡ä»¤</h2><p>docker-compose up è‡ªåŠ¨å®ŒæˆåŒ…æ‹¬æ„å»ºé•œåƒã€ï¼ˆé‡æ–°ï¼‰åˆ›å»ºæœåŠ¡ã€å¯åŠ¨æœåŠ¡ï¼Œå¹¶å…³è”æœåŠ¡ç›¸å…³å®¹å™¨çš„ä¸€ç³»åˆ—æ“ä½œ docker-compose build</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># -f  æŒ‡å®šä½¿ç”¨çš„ Compose æ¨¡æ¿æ–‡ä»¶ï¼Œé»˜è®¤ä¸º docker-compose.ymlï¼Œå¯ä»¥å¤šæ¬¡æŒ‡å®šã€‚</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">docker-compose -f docker-compose.yml up -d</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># å¯åŠ¨æ‰€æœ‰å®¹å™¨ï¼Œ-d å°†ä¼šåœ¨åå°å¯åŠ¨å¹¶è¿è¡Œæ‰€æœ‰çš„å®¹å™¨</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">docker-compose up -d</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># æŸ¥çœ‹æœåŠ¡å®¹å™¨çš„è¾“å‡º</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">docker-compose logs</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># åˆ—å‡ºé¡¹ç›®ä¸­ç›®å‰çš„æ‰€æœ‰å®¹å™¨</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">docker-compose </span><span class="token function">ps</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># æ„å»ºï¼ˆé‡æ–°æ„å»ºï¼‰é¡¹ç›®ä¸­çš„æœåŠ¡å®¹å™¨</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># æœåŠ¡å®¹å™¨ä¸€æ—¦æ„å»ºåï¼Œå°†ä¼šå¸¦ä¸Šä¸€ä¸ªæ ‡è®°åï¼Œä¾‹å¦‚å¯¹äº web é¡¹ç›®ä¸­çš„ä¸€ä¸ª db å®¹å™¨ï¼Œå¯èƒ½æ˜¯ web_db</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># å¯ä»¥éšæ—¶åœ¨é¡¹ç›®ç›®å½•ä¸‹è¿è¡Œ docker-compose build æ¥é‡æ–°æ„å»ºæœåŠ¡</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">docker-compose build</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># æ‹‰å–æœåŠ¡ä¾èµ–çš„é•œåƒ</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">docker-compose pull</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># é‡å¯é¡¹ç›®ä¸­çš„æœåŠ¡</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># å¦‚æœå¯¹ docker-compose.yml é…ç½®è¿›è¡Œæ›´æ”¹ï¼Œåˆ™è¿è¡Œæ­¤å‘½ä»¤åä¸ä¼šåæ˜ è¿™äº›æ›´æ”¹</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">docker-compose restart</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># åˆ é™¤æ‰€æœ‰ï¼ˆåœæ­¢çŠ¶æ€çš„ï¼‰æœåŠ¡å®¹å™¨</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># æ¨èå…ˆæ‰§è¡Œ docker-compose stop å‘½ä»¤æ¥åœæ­¢å®¹å™¨</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸åˆ é™¤é™„åŠ åˆ°å®¹å™¨çš„åŒ¿åå·</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># ä»»ä½•ä¸åœ¨å·ä¸­çš„æ•°æ®éƒ½å°†ä¸¢å¤±</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">docker-compose </span><span class="token function">rm</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># åœ¨æŒ‡å®šæœåŠ¡ä¸Šæ‰§è¡Œä¸€ä¸ªå‘½ä»¤ã€‚</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">docker-compose run ubuntu </span><span class="token function">ping</span><span class="token plain"> docker.com</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># è®¾ç½®æŒ‡å®šæœåŠ¡è¿è¡Œçš„å®¹å™¨ä¸ªæ•°</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># é€šè¿‡ service=num çš„å‚æ•°æ¥è®¾ç½®æ•°é‡</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">docker-compose scale </span><span class="token assign-left variable">web</span><span class="token operator">=</span><span class="token number">3</span><span class="token plain"> </span><span class="token assign-left variable">db</span><span class="token operator">=</span><span class="token number">2</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># å¯åŠ¨å·²ç»å­˜åœ¨çš„æœåŠ¡å®¹å™¨ã€‚</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">docker-compose start</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># åœæ­¢å·²ç»å¤„äºè¿è¡ŒçŠ¶æ€çš„å®¹å™¨ï¼Œä½†ä¸åˆ é™¤å®ƒ</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># é€šè¿‡ docker-compose start å¯ä»¥å†æ¬¡å¯åŠ¨è¿™äº›å®¹å™¨ã€‚</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">docker-compose stop</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="up"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/docker-compose#up"><span class="icon,icon-link"></span></a>up</h3><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">docker-compose up </span><span class="token punctuation">[</span><span class="token plain">options</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">--scale </span><span class="token assign-left variable">SERVICE</span><span class="token operator">=</span><span class="token plain">NUM</span><span class="token punctuation">..</span><span class="token plain">.</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">SERVICE</span><span class="token punctuation">..</span><span class="token plain">.</span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><ul><li><code>-d</code>ï¼šåœ¨åå°è¿è¡ŒæœåŠ¡å®¹å™¨</li><li><code>-no-color</code>ï¼šä¸ä½¿ç”¨é¢œè‰²æ¥åŒºåˆ†ä¸åŒçš„æœåŠ¡çš„æ§åˆ¶è¾“å‡º</li><li><code>-no-deps</code>ï¼šä¸å¯åŠ¨æœåŠ¡æ‰€é“¾æ¥çš„å®¹å™¨</li><li><code>-force-recreate</code>ï¼šå¼ºåˆ¶é‡æ–°åˆ›å»ºå®¹å™¨ï¼Œä¸èƒ½ä¸ <code>â€“no-recreate</code> åŒæ—¶ä½¿ç”¨</li><li><code>-no-recreate</code>ï¼šå¦‚æœå®¹å™¨å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸é‡æ–°åˆ›å»ºï¼Œä¸èƒ½ä¸ <code>â€“force-recreate</code> åŒæ—¶ä½¿ç”¨</li><li><code>-no-build</code>ï¼šä¸è‡ªåŠ¨æ„å»ºç¼ºå¤±çš„æœåŠ¡é•œåƒ</li><li><code>-build</code>ï¼šåœ¨å¯åŠ¨å®¹å™¨å‰æ„å»ºæœåŠ¡é•œåƒ</li><li><code>-abort-on-container-exit</code>ï¼šåœæ­¢æ‰€æœ‰å®¹å™¨ï¼Œå¦‚æœä»»ä½•ä¸€ä¸ªå®¹å™¨è¢«åœæ­¢ï¼Œä¸èƒ½ä¸ <code>-d</code> åŒæ—¶ä½¿ç”¨</li><li><code>-t</code>ã€<code>-timeout TIME</code>ï¼šåœæ­¢å®¹å™¨æ—¶å€™çš„è¶…æ—¶ï¼ˆé»˜è®¤ä¸º 10 ç§’ï¼‰</li><li><code>-remove-orphans</code>ï¼šåˆ é™¤æœåŠ¡ä¸­æ²¡æœ‰åœ¨ compose æ–‡ä»¶ä¸­å®šä¹‰çš„å®¹å™¨</li><li><code>-scale SERVICE=NUM</code>ï¼šè®¾ç½®æœåŠ¡è¿è¡Œå®¹å™¨çš„ä¸ªæ•°ï¼Œå°†è¦†ç›–åœ¨ compose ä¸­é€šè¿‡ scale æŒ‡å®šçš„å‚æ•°</li></ul><p>å½“ <code>docker-compose up</code> å‘½ä»¤æ±‡æ€»æ¯ä¸ªå®¹å™¨çš„è¾“å‡ºï¼ˆæœ¬è´¨ä¸Šæ˜¯ <code>docker-compose logs -f</code>ï¼‰ã€‚å½“å‘½ä»¤é€€å‡ºæ—¶ï¼Œæ‰€æœ‰å®¹å™¨éƒ½å°†åœæ­¢ã€‚è¿è¡Œ <code>docker-compose up -d</code> å°†åœ¨åå°å¯åŠ¨å®¹å™¨å¹¶ä½¿å®ƒä»¬ç»§ç»­è¿è¡Œã€‚</p><h3 id="build-1"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/docker-compose#build-1"><span class="icon,icon-link"></span></a>build</h3><p>å®é™…é¡¹ç›®ä¸­ï¼Œä¸å¯èƒ½åªå•å•ä¾èµ–äºä¸€ä¸ªæœåŠ¡ï¼Œä¾‹å¦‚ä¸€ä¸ªå¸¸è§çš„ Web é¡¹ç›®å¯èƒ½ä¾èµ–äº: é™æ€æ–‡ä»¶æœåŠ¡å™¨ï¼Œåº”ç”¨æœåŠ¡å™¨ï¼ŒMysql æ•°æ®åº“ç­‰ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ†åˆ«å¯åŠ¨å•ä¸ªé•œåƒï¼Œå¹¶æŠŠé•œåƒç»‘å®šåˆ°æœ¬åœ°å¯¹åº”ç«¯å£çš„å½¢å¼è¿›è¡Œéƒ¨ç½²ï¼Œè¾¾åˆ°å®¹å™¨å¯é€šä¿¡çš„ç›®çš„ã€‚ä½†æ˜¯ä¸ºäº†æ›´æ–¹ä¾¿çš„ç®¡ç†å¤šå®¹å™¨çš„æƒ…å†µï¼Œå®˜æ–¹æä¾›äº† docker-compose çš„æ–¹å¼ã€‚docker-compose æ˜¯ Docker çš„ä¸€ç§ç¼–æ’æœåŠ¡ï¼Œæ˜¯ä¸€ä¸ªç”¨äºåœ¨ Docker ä¸Šå®šä¹‰å¹¶è¿è¡Œå¤æ‚åº”ç”¨çš„å·¥å…·ï¼Œå¯ä»¥è®©ç”¨æˆ·åœ¨é›†ç¾¤ä¸­éƒ¨ç½²åˆ†å¸ƒå¼åº”ç”¨ã€‚</p><p>compose ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼š</p><ul><li>æœåŠ¡ï¼ˆserviceï¼‰ï¼šä¸€ä¸ªåº”ç”¨çš„å®¹å™¨ï¼Œå®é™…ä¸Šå¯ä»¥åŒ…æ‹¬è‹¥å¹²è¿è¡Œç›¸åŒé•œåƒçš„å®¹å™¨ç¤ºä¾‹</li><li>é¡¹ç›®ï¼ˆprojectï¼‰ï¼šç”±ä¸€ç»„å…³è”çš„åº”ç”¨å®¹å™¨ç»„æˆçš„ä¸€ä¸ªå®Œæ•´ä¸šåŠ¡å•å…ƒï¼Œåœ¨ <code>docker-compose.yml</code> æ–‡ä»¶ä¸­å®šä¹‰</li></ul><p>ä¸€ä¸ªé¡¹ç›®å¯ä»¥ç”±å¤šä¸ªæœåŠ¡ï¼ˆå®¹å™¨ï¼‰å…³è”è€Œæˆï¼Œcompose é¢å‘é¡¹ç›®è¿›è¡Œç®¡ç†ï¼Œé€šè¿‡è‡ªå‘½ä»¤å¯¹é¡¹ç›®ä¸­çš„ä¸€ç»„å®¹å™¨è¿›è¡Œä¾¿æ·çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">docker-compose build </span><span class="token punctuation">[</span><span class="token plain">options</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">--build-arg </span><span class="token assign-left variable">key</span><span class="token operator">=</span><span class="token plain">val</span><span class="token punctuation">..</span><span class="token plain">.</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">SERVICE</span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>é€‰é¡¹åŒ…æ‹¬ï¼š</p><ul><li><code>--compress</code>ï¼šé€šè¿‡ gzip å‹ç¼©æ„å»ºä¸Šä¸‹ç¯å¢ƒ</li><li><code>--force-rm</code>ï¼šåˆ é™¤æ„å»ºè¿‡ç¨‹ä¸­çš„ä¸´æ—¶å®¹å™¨</li><li><code>--no-cache</code>ï¼šæ„å»ºé•œåƒè¿‡ç¨‹ä¸­ä¸ä½¿ç”¨ç¼“å­˜</li><li><code>--pull</code>ï¼šå§‹ç»ˆå°è¯•é€šè¿‡æ‹‰å–æ“ä½œæ¥è·å–æ›´æ–°ç‰ˆæœ¬çš„é•œåƒ</li><li><code>-m, --memory</code>ï¼š MEM ä¸ºæ„å»ºçš„å®¹å™¨è®¾ç½®å†…å­˜å¤§å°</li><li><code>--build-arg key=val</code>ï¼šä¸ºæœåŠ¡è®¾ç½® build-time å˜é‡</li><li><code>--parallel</code>ï¼šå¹¶è¡Œæ„å»ºæ˜ åƒ</li></ul><h3 id="exec"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/docker-compose#exec"><span class="icon,icon-link"></span></a>exec</h3><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">docker-compose </span><span class="token builtin class-name">exec</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">options</span><span class="token punctuation">]</span><span class="token plain"> SERVICE COMMAND </span><span class="token punctuation">[</span><span class="token plain">ARGS</span><span class="token punctuation">..</span><span class="token plain">.</span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>ç­‰åŒäº <code>docker exec</code>ï¼Œä½¿ç”¨æ­¤å­å‘½ä»¤ï¼Œå¯ä»¥åœ¨æœåŠ¡ä¸­è¿è¡Œä»»æ„å‘½ä»¤ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå‘½ä»¤æ˜¯åˆ†é…ç»™ TTY çš„ï¼Œå› æ­¤æ‚¨å¯ä»¥ä½¿ç”¨å‘½ä»¤ <code>docker-compose exec web sh</code> æ¥è·å¾—äº¤äº’å¼æç¤ºã€‚</p><ul><li><code>-d</code>ï¼šåˆ†ç¦»æ¨¡å¼ï¼Œåå°è¿è¡Œå‘½ä»¤</li><li><code>--privileged</code>ï¼šè·å–ç‰¹æƒ</li><li><code>-u</code>ï¼šæŒ‡å®šè¿è¡Œçš„ç”¨æˆ·</li><li><code>-T</code>ï¼šç¦ç”¨åˆ†é… TTY</li><li><code>--index=index</code>ï¼šå½“ä¸€ä¸ªæœåŠ¡æ‹¥æœ‰å¤šä¸ªå®¹å™¨æ—¶ï¼Œå¯é€šè¿‡è¯¥å‚æ•°ç™»é™†åˆ°è¯¥æœåŠ¡ä¸‹çš„ä»»ä½•æœåŠ¡ï¼Œä¾‹å¦‚ï¼š <code>docker-compose exec â€“index=1 web /bin/bash</code>ï¼ŒWeb æœåŠ¡ä¸­åŒ…å«å¤šä¸ªå®¹å™¨</li><li><code>-e, --env KEY=VAL</code>ï¼šè®¾ç½®ç¯å¢ƒå˜é‡</li><li><code>-w, --workdir</code>ï¼šæŒ‡å‘æ­¤å‘½ä»¤çš„ workdir ç›®å½•çš„è·¯å¾„</li></ul><h2 id="ç¯å¢ƒå˜é‡"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/docker-compose#ç¯å¢ƒå˜é‡"><span class="icon,icon-link"></span></a>ç¯å¢ƒå˜é‡</h2><p>åœ¨ compose file ä¸­å¼•ç”¨ç¯å¢ƒå˜é‡</p><p>å‚è€ƒï¼š<a target="_blank" rel="noopener noreferrer" href="https://www.cnblogs.com/sparkdev/p/9826520.html">Docker Compose å¼•ç”¨ç¯å¢ƒå˜é‡<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><div class="__dumi-default-code-block"><pre class="prism-code language-yml"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token key atrule">version</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;3&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">web</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation">:</span><span class="token plain"> $</span><span class="token punctuation">{</span><span class="token plain">IMAGETAG</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">-</span><span class="token plain"> </span><span class="token string">&#x27;5000:5000&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">redis</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;redis:alpine&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>é€šè¿‡ç¯å¢ƒå˜é‡ <code>$<!-- -->{<!-- -->IMAGETAG<!-- -->}</code> æŒ‡å®šäº† web çš„é•œåƒï¼Œä¸‹é¢é€šè¿‡ <code>export</code> çš„æ–¹å¼æ¥ compose é…ç½®æ–‡ä»¶ä¸­çš„ç¯å¢ƒå˜é‡ä¼ å€¼ï¼š</p><p>âš ï¸ æ³¨æ„ï¼šå¦‚æœå¯¹åº”çš„ç¯å¢ƒå˜é‡æ²¡æœ‰è¢«è®¾ç½®ï¼Œé‚£ä¹ˆ compose å°±ä¼šæŠŠå®ƒæ›¿æ¢ä¸ºä¸€ä¸ªç©ºå­—ç¬¦ä¸²</p><p>è¿™ç§æƒ…å†µï¼Œå¯ä»¥ä¸ºå˜é‡è®¾ç½®é»˜è®¤å€¼ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-yml"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token key atrule">version</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;3&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">web</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation">:</span><span class="token plain"> $</span><span class="token punctuation">{</span><span class="token key atrule">IMAGETAG</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">-</span><span class="token plain">defaultwebimage</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">-</span><span class="token plain"> </span><span class="token string">&quot;5000:5000&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">redis</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&quot;redis:alpine&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><code>defaultwebimage</code> æ˜¯é»˜è®¤å€¼ã€‚</p><h3 id="æŠŠç¯å¢ƒå˜é‡ä¼ é€’ç»™å®¹å™¨"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/docker-compose#æŠŠç¯å¢ƒå˜é‡ä¼ é€’ç»™å®¹å™¨"><span class="icon,icon-link"></span></a>æŠŠç¯å¢ƒå˜é‡ä¼ é€’ç»™å®¹å™¨</h3><p>compose file ä¸­ä¸ºå®¹å™¨è®¾ç½®ç¯å¢ƒå˜é‡ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-yml"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token key atrule">web</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">environment</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">DEBUG</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>compose file ä¸­çš„ environment èŠ‚ç‚¹ç”¨æ¥ä¸ºå®¹å™¨è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä¸Šé¢çš„å†™æ³•ç­‰åŒäºï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ docker run -e </span><span class="token assign-left variable">DEBUG</span><span class="token operator">=</span><span class="token number">1</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>è¦æŠŠå½“å‰ shell ç¯å¢ƒå˜é‡çš„å€¼ä¼ é€’ç»™å®¹å™¨çš„ç¯å¢ƒå˜é‡ä¹Ÿå¾ˆç®€å•ï¼Œå»æ‰ä¸Šé¢ä»£ç ä¸­çš„èµ‹å€¼éƒ¨åˆ†å³å¯ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-yml"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token key atrule">web</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">environment</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">DEBUG</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>å°è¯•å¯¼å‡ºç¯å¢ƒå˜é‡ <code>DEBUG</code> çš„æƒ…å†µï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ </span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable">DEBUG</span><span class="token operator">=</span><span class="token number">1</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="ç¯å¢ƒå˜é‡æ–‡ä»¶"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/docker-compose#ç¯å¢ƒå˜é‡æ–‡ä»¶"><span class="icon,icon-link"></span></a>ç¯å¢ƒå˜é‡æ–‡ä»¶</h3><p>å½“æˆ‘ä»¬åœ¨ <code>docker-compose.yml</code> æ–‡ä»¶ä¸­å¼•ç”¨äº†å¤§é‡çš„ç¯å¢ƒå˜é‡æ—¶ï¼Œå¯¹æ¯ä¸ªç¯å¢ƒå˜é‡éƒ½è®¾ç½®é»˜è®¤å€¼å°†æ˜¯ç¹ççš„ï¼Œå¹¶ä¸”ä¹Ÿä¼šå½±å“ <code>docker-compose.yml</code> ç®€æ´ç¨‹åº¦ã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡ .<code>env</code> æ–‡ä»¶æ¥ä¸º <code>docker-compose.yml</code> æ–‡ä»¶å¼•ç”¨çš„æ‰€æœ‰ç¯å¢ƒå˜é‡è®¾ç½®é»˜è®¤å€¼ã€‚</p><p>ä¿®æ”¹ <code>docker-compose.yml</code> æ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-yml"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token key atrule">version</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;3&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">web</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation">:</span><span class="token plain"> $</span><span class="token punctuation">{</span><span class="token plain">IMAGETAG</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token key atrule">APPNAME</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token key atrule">AUTHOR</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token key atrule">VERSION</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">-</span><span class="token plain"> </span><span class="token string">&#x27;5000:5000&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token key atrule">redis</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;redis:alpine&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>ç„¶ååœ¨ç›¸åŒçš„ç›®å½•ä¸‹åˆ›å»º <code>.env</code> æ–‡ä»¶ï¼Œç¼–è¾‘å…¶å†…å®¹å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain"># define env var default value.</span></div><div class="token-line"><span class="token plain">IMAGETAG=defaultwebimage</span></div><div class="token-line"><span class="token plain">APPNAME=default app name</span></div><div class="token-line"><span class="token plain">AUTHOR=default author name</span></div><div class="token-line"><span class="token plain">VERSION=default version is 1.0</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="é…ç½®ä¸åŒåœºæ™¯ä¸‹çš„ç¯å¢ƒå˜é‡"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/docker-compose#é…ç½®ä¸åŒåœºæ™¯ä¸‹çš„ç¯å¢ƒå˜é‡"><span class="icon,icon-link"></span></a>é…ç½®ä¸åŒåœºæ™¯ä¸‹çš„ç¯å¢ƒå˜é‡</h3><p>ä»å‰é¢çš„éƒ¨åˆ†ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œdocker compose æä¾›äº†è¶³å¤Ÿçš„çµæ´»æ€§æ¥è®©æˆ‘ä»¬è®¾ç½® docker-compose.yml æ–‡ä»¶ä¸­å¼•ç”¨çš„ç¯å¢ƒå˜é‡ï¼Œå®ƒä»¬çš„ä¼˜å…ˆçº§å¦‚ä¸‹ï¼š</p><ol><li>Compose file</li><li>Shell environment variables</li><li>Environment file</li><li>Dockerfile</li><li>Variable is not defined</li></ol><ul><li>é¦–å…ˆï¼Œåœ¨ docker-compose.yml æ–‡ä»¶ä¸­ç›´æ¥è®¾ç½®çš„å€¼ä¼˜å…ˆçº§æ˜¯æœ€é«˜çš„ã€‚</li><li>ç„¶åæ˜¯åœ¨å½“å‰ shell ä¸­ export çš„ç¯å¢ƒå˜é‡å€¼ã€‚</li><li>æ¥ä¸‹æ¥æ˜¯åœ¨ç¯å¢ƒå˜é‡æ–‡ä»¶ä¸­å®šä¹‰çš„å€¼ã€‚</li><li>å†æ¥ä¸‹æ¥æ˜¯åœ¨ Dockerfile ä¸­å®šä¹‰çš„å€¼ã€‚</li><li>æœ€åè¿˜æ²¡æœ‰æ‰¾åˆ°ç›¸å…³çš„ç¯å¢ƒå˜é‡å°±è®¤ä¸ºè¯¥ç¯å¢ƒå˜é‡æ²¡æœ‰è¢«å®šä¹‰ã€‚</li></ul><p>æ ¹æ®ä¸Šé¢çš„ä¼˜å…ˆçº§å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸åŒåœºæ™¯ä¸‹çš„ç¯å¢ƒå˜é‡å®šä¹‰åœ¨ä¸åŒçš„ shell è„šæœ¬ä¸­å¹¶å¯¼å‡ºï¼Œç„¶ååœ¨æ‰§è¡Œ <code>docker-compose</code> å‘½ä»¤å‰å…ˆæ‰§è¡Œ <code>source</code> å‘½ä»¤æŠŠ shell è„šæœ¬ä¸­å®šä¹‰çš„ç¯å¢ƒå˜é‡å¯¼å‡ºåˆ°å½“å‰çš„ shell ä¸­ã€‚é€šè¿‡è¿™æ ·çš„æ–¹å¼å¯ä»¥å‡å°‘ç»´æŠ¤ç¯å¢ƒå˜é‡çš„åœ°æ–¹ï¼Œä¸‹é¢çš„ä¾‹å­ä¸­æˆ‘ä»¬åˆ†åˆ«åœ¨ <code>docker-compose.yml</code> æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•åˆ›å»º <code>test.sh</code> å’Œ <code>prod.sh</code>ã€‚</p><p><code>test.sh</code> çš„å†…å®¹å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># define env var default value.</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable">IMAGETAG</span><span class="token operator">=</span><span class="token plain">web:v1</span></div><div class="token-line"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable">APPNAME</span><span class="token operator">=</span><span class="token plain">HelloWorld</span></div><div class="token-line"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable">AUTHOR</span><span class="token operator">=</span><span class="token plain">Nick Li</span></div><div class="token-line"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable">VERSION</span><span class="token operator">=</span><span class="token number">1.0</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><code>prod.sh</code> çš„å†…å®¹å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># define env var default value.</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable">IMAGETAG</span><span class="token operator">=</span><span class="token plain">webpord:v1</span></div><div class="token-line"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable">APPNAME</span><span class="token operator">=</span><span class="token plain">HelloWorldProd</span></div><div class="token-line"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable">AUTHOR</span><span class="token operator">=</span><span class="token plain">Nick Li</span></div><div class="token-line"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable">VERSION</span><span class="token operator">=</span><span class="token number">1</span><span class="token plain">.0LTS</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>åœ¨æµ‹è¯•ç¯å¢ƒä¸‹ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ </span><span class="token builtin class-name">source</span><span class="token plain"> test.sh</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ docker-compose config</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>æ­¤æ—¶ docker-compose.yml ä¸­çš„ç¯å¢ƒå˜é‡åº”ç”¨çš„éƒ½æ˜¯ç”Ÿäº§ç¯å¢ƒç›¸å…³çš„è®¾ç½®ã€‚</p><hr/><p><strong>å‚è€ƒèµ„æ–™ï¼š</strong></p><ul><li><a target="_blank" rel="noopener noreferrer" href="https://docs.docker.com/compose/compose-file/">ğŸ“– Compose file reference for Version 3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://juejin.im/post/5d76e977e51d4557dc774f1c">ğŸ“ Docker Compose ç¼–æ’æŒ‡å— v3.7ï¼ˆå†…å®¹æ¯”è¾ƒè¯¦å®ï¼‰<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://yeasy.gitbooks.io/docker_practice/content/compose/compose_file.html">ğŸ“ Docker å®æˆ˜æ‰‹å†Œï¼šæ¨¡ç‰ˆæ–‡ä»¶<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/devops-guidebook/edit/master/docs/deploy/docker/docker-compose.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last update: ">6/25/2021 02:42:31</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/devops-guidebook/umi.js"></script>
    <script src="/devops-guidebook/docs__deploy__docker__docker-compose.md.js"></script>
  </body>
</html>
