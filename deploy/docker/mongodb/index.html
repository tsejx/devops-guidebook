<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/devops-guidebook/umi.css" />
    <script>
      window.routerBase = "/devops-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.9
    </script>
    <title>&#x90E8;&#x7F72; MongoDB</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/deploy/docker/mongodb" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/devops-icon.png&#x27;)" href="/devops-guidebook//">DevOps Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a href="/devops-guidebook//linux">Linux</a></span><span><a href="/devops-guidebook//server">服务器</a></span><span><a aria-current="page" class="active" href="/devops-guidebook//deploy">部署</a></span><span><a href="/devops-guidebook//code">代码管理</a></span><span><a href="/devops-guidebook//devops">DevOps</a></span><span><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/devops-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/devops-icon.png&#x27;)" href="/devops-guidebook//"></a><h1>DevOps Guidebook</h1><p>DevOps 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/devops-guidebook//linux">Linux</a></li><li><a href="/devops-guidebook//server">服务器</a></li><li><a aria-current="page" class="active" href="/devops-guidebook//deploy">部署</a></li><li><a href="/devops-guidebook//code">代码管理</a></li><li><a href="/devops-guidebook//devops">DevOps</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/devops-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/devops-guidebook//deploy/theory">部署理论</a><ul><li><a href="/devops-guidebook//deploy/theory"><span>基本概述</span></a></li><li><a href="/devops-guidebook//deploy/theory/environment"><span>环境区分</span></a></li><li><a href="/devops-guidebook//deploy/theory/continuous-integration"><span>持续集成</span></a></li><li><a href="/devops-guidebook//deploy/theory/continuous-dilivery"><span>持续交付</span></a></li><li><a href="/devops-guidebook//deploy/theory/continuous-deployment"><span>持续部署</span></a></li><li><a href="/devops-guidebook//deploy/theory/blue-green-deployment"><span>蓝绿部署</span></a></li><li><a href="/devops-guidebook//deploy/theory/gray-release"><span>灰度部署</span></a></li><li><a href="/devops-guidebook//deploy/theory/rolling-update"><span>滚动部署</span></a></li></ul></li><li><a aria-current="page" class="active" href="/devops-guidebook//deploy/docker">Docker</a><ul><li><a href="/devops-guidebook//deploy/docker/overview"><span>基本概述</span></a></li><li><a href="/devops-guidebook//deploy/docker/image"><span>构建镜像</span></a></li><li><a href="/devops-guidebook//deploy/docker/docker-file"><span>配置脚本</span></a></li><li><a href="/devops-guidebook//deploy/docker/container"><span>操作容器</span></a></li><li><a href="/devops-guidebook//deploy/docker/storage-patterns-for-persistence"><span>持久存储模式</span></a></li><li><a href="/devops-guidebook//deploy/docker/network"><span>网络通信</span></a></li><li><a href="/devops-guidebook//deploy/docker/operations-and-monitor"><span>运维和监控</span></a></li><li><a href="/devops-guidebook//deploy/docker/docker-compose"><span>多容器部署</span></a></li><li><a href="/devops-guidebook//deploy/docker/command"><span>常用命令</span></a></li><li><a href="/devops-guidebook//deploy/docker/extensions"><span>扩展资源</span></a></li><li><a aria-current="page" class="active" href="/devops-guidebook//deploy/docker/mongodb"><span>部署 MongoDB</span></a></li></ul></li><li><a href="/devops-guidebook//deploy/github-actions">Github-actions</a><ul><li><a href="/devops-guidebook//deploy/github-actions"><span>Github Actions</span></a></li></ul></li><li><a href="/devops-guidebook//deploy/jenkins">Jenkins</a></li><li><a href="/devops-guidebook//deploy/rancher">Rancher</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="镜像安装" data-depth="2"><a href="/devops-guidebook//deploy/docker/mongodb#镜像安装"><span>镜像安装</span></a></li><li title="容器创建" data-depth="2"><a href="/devops-guidebook//deploy/docker/mongodb#容器创建"><span>容器创建</span></a></li><li title="容器基本创建方法和数据目录挂载" data-depth="3"><a href="/devops-guidebook//deploy/docker/mongodb#容器基本创建方法和数据目录挂载"><span>容器基本创建方法和数据目录挂载</span></a></li><li title="容器的数据迁移" data-depth="3"><a href="/devops-guidebook//deploy/docker/mongodb#容器的数据迁移"><span>容器的数据迁移</span></a></li><li title="设置登录权限问题" data-depth="3"><a href="/devops-guidebook//deploy/docker/mongodb#设置登录权限问题"><span>设置登录权限问题</span></a></li><li title="容器数据目录挂载" data-depth="2"><a href="/devops-guidebook//deploy/docker/mongodb#容器数据目录挂载"><span>容器数据目录挂载</span></a></li><li title="数据迁移" data-depth="2"><a href="/devops-guidebook//deploy/docker/mongodb#数据迁移"><span>数据迁移</span></a></li><li title="常用 Docker 命令" data-depth="2"><a href="/devops-guidebook//deploy/docker/mongodb#常用-docker-命令"><span>常用 Docker 命令</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="部署-mongodb"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/mongodb#部署-mongodb"><span class="icon,icon-link"></span></a>部署 MongoDB</h1><h2 id="镜像安装"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/mongodb#镜像安装"><span class="icon,icon-link"></span></a>镜像安装</h2><p>MongoDB 提供官方镜像，下载安装镜像方法如下：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 最新版本 MongoDB</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ docker pull mongo</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 或者，指定需要的版本</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ docker pull mongo:4.0.4</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="容器创建"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/mongodb#容器创建"><span class="icon,icon-link"></span></a>容器创建</h2><p>MongoDB Docker 容器创建有以下几个问题：</p><ol><li>MongoDB 容器基本创建方法和数据目录挂载</li><li>MongoDB 容器的数据迁移</li><li>MongoDB 设置登录权限问题</li></ol><h3 id="容器基本创建方法和数据目录挂载"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/mongodb#容器基本创建方法和数据目录挂载"><span class="icon,icon-link"></span></a>容器基本创建方法和数据目录挂载</h3><p>MongoDB 容器基本创建命令如下：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ docker run -p </span><span class="token number">27017</span><span class="token plain">:27017 -v </span><span class="token operator">&lt;</span><span class="token plain">LocalDirectoryPath</span><span class="token operator">&gt;</span><span class="token plain">:/data/db --name docker_mongodb -d mongo</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>在上面的命令中，几个命令参数的详细解释如下：</p><ul><li><code>-p</code>：映射容器服务的 27017 端口到宿主机的 27017 端口，mongodb 默认端口为 27017。容器外部可以通过宿主机 IP 27017 端口访问到容器内的 mongodb 服务</li><li><code>-v</code>：为设置容器的挂载目录，这里是将 <code>&lt;LocalDirectoryPath&gt;</code> 即本机中的目录挂载到容器中的 <code>/data/db</code>中，作为 mongodb 的存储目录（建议为 <code>/mongodb/data</code>）</li><li><code>--name</code>：为设置该容器的名称</li><li><code>-d</code>：设置容器以守护进程方式运行</li></ul><p>其他：<code>--auth</code> 需要密码才能访问容器服务</p><p>进入 mongodb 服务的容器内运行 mongodb</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># docker_mongodb 是装载 mongodb 服务容器名称</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># mongo 是代表执行容器内的 mongo 命令，即进入 mongodb 命令行操作界面</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ docker </span><span class="token builtin class-name">exec</span><span class="token plain"> -it docker_mongodb mongo</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="容器的数据迁移"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/mongodb#容器的数据迁移"><span class="icon,icon-link"></span></a>容器的数据迁移</h3><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 停止原有的 docker_mongodb 容器</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ docker stop docker_mongodb</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 再创建一个 docker 容器，挂载原容器的数据目录</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ docker run -p </span><span class="token number">27017</span><span class="token plain">:27017 -v </span><span class="token operator">&lt;</span><span class="token plain">LocalDirectoryPath</span><span class="token operator">&gt;</span><span class="token plain">:/data/db --name docker_mongodb_migration -d mongo</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查询当前 docker 容器状态</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ docker container </span><span class="token function">ls</span><span class="token plain"> -a</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 从输出结果可以看到，这时 docker_mongodb 的状态是 exited，表示已经退出</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 而新创建的 docker_mongodb_migration 的状态显示为 Up 表明数据库正在运行</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="设置登录权限问题"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/mongodb#设置登录权限问题"><span class="icon,icon-link"></span></a>设置登录权限问题</h3><h2 id="容器数据目录挂载"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/mongodb#容器数据目录挂载"><span class="icon,icon-link"></span></a>容器数据目录挂载</h2><h2 id="数据迁移"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/mongodb#数据迁移"><span class="icon,icon-link"></span></a>数据迁移</h2><h2 id="常用-docker-命令"><a aria-hidden="true" tabindex="-1" href="/devops-guidebook//deploy/docker/mongodb#常用-docker-命令"><span class="icon,icon-link"></span></a>常用 Docker 命令</h2><p>拉取镜像、运行容器</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 查看镜像</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">docker images</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">#</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">docker run -d -p </span><span class="token number">27017</span><span class="token plain">-27019:27017-27019 --name mongodb mongo:4.0.4</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">#</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">docker </span><span class="token function">ps</span><span class="token plain"> -a</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 关闭</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">docker stop mongodb</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 再重启</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">docker run -d -p </span><span class="token number">27017</span><span class="token plain">-27019:27017-27019 --name mongodb mongo:4.0.4</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">#</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">docker </span><span class="token function">ps</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 进入容器</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">docker </span><span class="token builtin class-name">exec</span><span class="token plain"> -it mongodb mongo</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">show dbs</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># this is a database name</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">use thepolyglotdeveloper</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.people.save</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain">firstname: </span><span class="token string">&quot;Nic&quot;</span><span class="token plain">, lastname: </span><span class="token string">&quot;Raboy&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.people.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.people.save</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain">firstname: </span><span class="token string">&quot;Maria&quot;</span><span class="token plain">, lastname: </span><span class="token string">&quot;Raboy&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.people.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">db.people.find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain">firstname: </span><span class="token string">&quot;Maria&quot;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token builtin class-name">exit</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">clear</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">docker stop mongodb</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">docker </span><span class="token function">rm</span><span class="token plain"> mongodb</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查看 docker 容器状态</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">docker </span><span class="token function">ps</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 查看数据库服务器日志</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">docker logs mongodb</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>Mongo Express 一个基于网络的 MongoDB 数据管理界面</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">docker pull mongo-express</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 运行</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">docker run --link mongodb:mongo -p </span><span class="token number">8081</span><span class="token plain">:8081 mongo-express</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><ol><li>数据库连接不成功？容器内部的服务无法被外部访问？</li></ol><ul><li>检查 Docker 宿主机器是否开启了防火墙，如果有请关闭防火墙。或者将宿主机器的端口加入到防火墙白名单。容器的端口没有关系，不需要做什么。</li><li>Docker 运行容器时，千万不能忘记 <code>-p</code> 参数，这个参数决定了 Docker 容器内部的服务可以被外部访问</li><li>用 <code>docker container ls</code> 检查你的容器是否启动成功了，很多情况不要忘记了 <code>-d</code> 参数，这个参数可以让容器后台运行。</li></ul><ol start="2"><li>几天后再使用 Docker，找不到此命令？容器也不在了？</li></ol><p>很可能是你的宿主机器重启了，你需要重新启动 Docker 服务，这很简单，尝试：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">service</span><span class="token plain"> start docker</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 或者</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">systemctl start docker</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>同理既然你的 Docker 服务都重启了，那么你的容器也是需要被重启的，因为他们现在都处于 <code>stop</code> 状态，可以尝试：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment"># 查看所有的docker容器，包括运行中的、停止的。</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ docker container </span><span class="token function">ls</span><span class="token plain"> -a</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment"># 输入你要启动的容器名称，它可以是一个名字也可以是一串字符串ID</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ docker start </span><span class="token operator">&lt;</span><span class="token plain">your container name</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><ol start="3"><li>如果你怎么都尝试不成功，可以试试 docker 重启大法，这不是开玩笑，非常有效！</li></ol><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">systemctl stop docker</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">systemctl start docker</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>构建 MongoDB 容器</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ docker pull mongo:latest</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ docker run --name docker_mongodb -d -p </span><span class="token number">27017</span><span class="token plain">:27017 mongo:latest --auth</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><code>--auth</code> 指令开启了 mongo 的连接身份校验 开启校验 是由于 node 跨容器连接时 不设置身份校验 开启服务端无法连接上 mongo 数据库</p><p>由于我们 mongo 开启了身份验证，所以我们要进入 mongo 容器配置一下 node 连接时使用的账号</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ docker </span><span class="token builtin class-name">exec</span><span class="token plain"> -it docker_mongodb /bin/bash</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ mongo admin</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.createUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain">user: </span><span class="token string">&quot;admin&quot;</span><span class="token plain">, pwd: </span><span class="token string">&quot;admin&quot;</span><span class="token plain">, roles: </span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token plain">role: </span><span class="token string">&quot;dbAdmin&quot;</span><span class="token plain">, db: </span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">$ db.auth</span><span class="token punctuation">(</span><span class="token string">&#x27;admin&#x27;</span><span class="token plain">, </span><span class="token string">&#x27;admin&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>构建 node 容器并与 mongo 容器建立连接</p><p>在开始构建 node 容器前我们要先约定好 mongo 容器别名，端口号及账号密码</p><ul><li>mongo 容器别名：db</li><li>mongo 端口号：27017</li><li>账号密码： <code>admin:admin</code></li></ul><p>我们先修改 node 服务端的配置</p><p>文件配置 dockerfile/api-mocker/server/config/config.default.js 修改 mongo 连接配置，db 为预先设定的 mock-mongo 容器的别名</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">mongoose: {</span></div><div class="token-line"><span class="token plain">  url: &#x27;mongodb://admin:admin@db:27017/api-mock?authSource=admin&#x27;</span></div><div class="token-line"><span class="token plain">}</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>构建镜像</p><div class="__dumi-default-code-block"><pre class="prism-code language-dockerfile"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">  # 指定基础镜像</span></div><div class="token-line"><span class="token plain">  FROM node:latest</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  # 维护者</span></div><div class="token-line"><span class="token plain">  MAINTAINER qiushiyuan1994@qq.com</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  # 工作目录</span></div><div class="token-line"><span class="token plain">  WORKDIR /www</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  # 将本地文件添拷贝到容器中，不会解压</span></div><div class="token-line"><span class="token plain">  COPY api-mocker node-server/api-mocker</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  EXPOSE 7001</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  WORKDIR /www/node-server/api-mocker/server</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  RUN npm install</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  WORKDIR /www/node-server/api-mocker</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  # 构建容器后调用，在容器启动时才进行调用</span></div><div class="token-line"><span class="token plain">  CMD [&quot;make&quot;, &quot;prod_server&quot;]</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>使用编写好的 dockerfile 构建镜像</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">docker build -t</span><span class="token operator">=</span><span class="token string">&quot;mock-server:1.0.0&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>运行镜像</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">docker run -d -i -t -p </span><span class="token number">7001</span><span class="token plain">:7001 --name mock-server1 --link mock-mongo:db mock-server:1.0.0 /bin/bash</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>让我们再看看现在正在运行的容器</p><p>检测 node 容器和 mongo 容器的连接状态</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">docker </span><span class="token builtin class-name">exec</span><span class="token plain"> -it mock-server /bin/bash</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">curl</span><span class="token plain"> db</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><hr/><p><strong>参考资料：</strong></p><ul><li><a target="_blank" rel="noopener noreferrer" href="https://www.jianshu.com/p/6fdb2bcb4b43">📝 Docker MongoDB 部署<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://www.cnblogs.com/codelove/p/10312692.html">📝 MongoDB 容器化<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://www.cnblogs.com/cwp-bg/p/10403327.html">📝 Docker 之安装和管理 MongoDB（含副本集相关）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/devops-guidebook/edit/master/docs/deploy/docker/mongodb.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last update: ">6/25/2021 02:50:35</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/devops-guidebook/umi.js"></script>
    <script src="/devops-guidebook/docs__deploy__docker__mongodb.md.js"></script>
  </body>
</html>
